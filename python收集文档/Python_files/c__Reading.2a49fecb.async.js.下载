(window.webpackJsonp=window.webpackJsonp||[]).push([[1287],{4147:function(e,t,r){"use strict";var n=r(0),o=r.n(n),a=r(2),i=r.n(a),c=r(65),u=r.n(c),d=r(35),s=r(251);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},l.apply(this,arguments)}var m=new u.a("doc:error"),p=Object(s.b)((function(){return Promise.all([r.e(0),r.e(1),r.e(3),r.e(13),r.e(1534)]).then(r.bind(null,2989))}),{suspense:!0}),b=Object(s.b)((function(){return Promise.all([r.e(0),r.e(1),r.e(3),r.e(13),r.e(1535)]).then(r.bind(null,2987))}),{suspense:!0}),g=Object(s.b)((function(){return Promise.all([r.e(0),r.e(1),r.e(3),r.e(13),r.e(1533)]).then(r.bind(null,2988))}),{suspense:!0}),h=Object(s.b)((function(){return r.e(1537).then(r.bind(null,4219))}),{suspense:!0});function f(e){var t=e.error;m("doc load error",t);var r=Object(d.useHistory)();return o.a.createElement("div",{"data-testid":"empty-view"},function(){if(403===t.status){if(null!=t&&t.needVerifyTargetId&&"need_verify_password"===(null==t?void 0:t.code))return o.a.createElement(p,{targetType:"Doc",needVerifyTargetId:t.needVerifyTargetId,onlyContent:!0});var e=t.data,n=e.organization,a=e.canReadOrg,i=e.groupLogin;return(n&&a||!window.appData.isYuque)&&i?o.a.createElement(g,l({},t.data,{history:r,onlyContent:!0})):o.a.createElement(b,l({},t.data,{history:r,onlyContent:!0}))}return[404,500].includes(t.status)?o.a.createElement(h,{status:t.status}):"no_local_cache"===t.message?o.a.createElement(h,{status:911}):o.a.createElement("div",{style:{height:"640px"}})}())}f.propTypes={error:i.a.object.isRequired},t.a=f},4207:function(e,t,r){"use strict";r.d(t,"a",(function(){return b}));r(131);var n=r(43),o=(r(142),r(28)),a=(r(1392),r(1397)),i=r(0),c=r.n(i),u="DocLoading-module_container_nhOpf",d="DocLoading-module_title_ORC1Y",s="DocLoading-module_loading_JiuDc",l="DocLoading-module_col_6Fw0R";function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],u=!0,d=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);u=!0);}catch(e){d=!0,o=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(d)throw o}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return p(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return p(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var b=function(e){var t=e.delayTime,r=void 0===t?100:t,p=e.enableDelay,b=void 0!==p&&p,g=m(Object(i.useState)(!1),2),h=g[0],f=g[1];return Object(i.useEffect)((function(){if(b){var e=setTimeout((function(){f(!0)}),r);return function(){clearTimeout(e)}}}),[]),h||!b?c.a.createElement("div",{className:u,style:e.style},c.a.createElement(a.a,{className:d,title:!0,paragraph:!1,active:!0}),c.a.createElement(n.a,{gutter:16,className:s},c.a.createElement(o.a,{span:24,className:l},c.a.createElement(a.a,{title:!1,paragraph:{rows:3},active:!0})),c.a.createElement(o.a,{span:24,className:l},c.a.createElement(a.a,{title:!1,paragraph:{rows:3},active:!0})))):null}},4216:function(e,t,r){"use strict";var n=r(0),o=r.n(n),a=r(2),i=r.n(a),c=r(469),u=r(4007);function d(e){var t,r=e.me,a=e.dispatch,i=e.organization,c=null===(t=window.appData.settings)||void 0===t?void 0:t.disabled_login_modal_pop_default;return Object(n.useEffect)((function(){var e,t=i&&i.id,n=null===(e=window.appData.settings)||void 0===e?void 0:e.is_trusted_organization;t&&(i.isPremium||n)&&(c=!0),window.location.pathname.startsWith("/yuque/")&&(c=!0),window.h5&&(c=!0);var o=Object(u.b)("doc_reader_login_modal",864e5);!(null!=r&&r.id||o||c)&&a({type:"error/toggleLoginModal",payload:{visible:!0,from:"doc_reader"}})}),[]),o.a.createElement(o.a.Fragment,null)}d.propTypes={me:i.a.object,dispatch:i.a.func,organization:i.a.object},t.a=Object(c.d)((function(e){return{me:e.me,dispatch:e.dispatch,organization:e.organization}}))(d)},4765:function(e,t,r){"use strict";var n=r(0),o=r.n(n),a=r(2),i=r.n(a),c=r(469),u=r(35),d=r(955),s=r.n(d),l=r(160),m=r.n(l),p=r(251),b=r(806),g=r(302),h=r(4318),f=r(3637),y=r(24),v=r(1516),j=r(4216),O=r(4147),R=r(4207),S=r(4222),w=r(532),E=Object(p.b)((function(){return r.e(1304).then(r.bind(null,4967))}),{suspense:!0}),k=Object(p.b)((function(){return r.e(1181).then(r.bind(null,4968))}),{suspense:!0}),_=Object(p.b)((function(){return r.e(1316).then(r.bind(null,4987))}),{suspense:!0}),C=Object(p.b)((function(){return Promise.all([r.e(0),r.e(16),r.e(1300)]).then(r.bind(null,4988))}),{suspense:!0}),D=Object(p.b)((function(){return Promise.all([r.e(4),r.e(5),r.e(6),r.e(0),r.e(1209)]).then(r.bind(null,4976))}),{suspense:!0});function P(e){var t=e.className,r=void 0===t?"":t,a=e.doc,i=e.group,c=e.book,u=e.isShare,d=e.showHeaderMeta,s=e.review,l=e.shouldRenderPager,m=e.shouldRenderComments,p=e.headingFolding,g=e.currentDocSlug,P=e.currentGroupSlug,q=e.currentBookSlug,M=Object(f.c)().editMode,T=Object(S.b)().sidePanelManager,B=Object(w.b)();Object(n.useEffect)((function(){var e=setTimeout((function(){k.preload(),C.preload()}),5e3);return function(){clearTimeout(e)}}),[]),Object(n.useEffect)((function(){var e=document.querySelector("Link[rel='shortcut icon']");e&&(e.href=function(e,t){var r=b.LOGO_FAVICON.public;if(e.isYuque){var n;r=t?b.EDIT_LOGO_FAVICON.public:(null===(n=e.organization)||void 0===n?void 0:n.logo)||b.LOGO_FAVICON.public}else{var o=t?b.EDIT_LOGO_FAVICON:b.LOGO_FAVICON,a=e.zone;r=o.alibaba,r=0===(null==a?void 0:a.id)?o.alibaba:o.antgroup}return r}(B,M))}),[B,M]);var N=o.a.useCallback((function(){e.dispatch({type:"doc/addCommentCount"})}),[]),G=o.a.useCallback((function(){e.dispatch({type:"doc/reduceCommentCount"})}),[]);return Object(n.useEffect)((function(){if(y.g&&a.loaded&&a.slug===g&&c.slug===q){var e="".concat(P,"/").concat(q);Object(v.a)("save",e,a.slug)}}),[a.loaded,a.slug,g,P,q]),a.loaded||M?a.error?o.a.createElement(O.a,{error:a.error}):g?a.loaded&&a.slug!==g?o.a.createElement("span",{"data-testid":"doc.loaded and doc.slug !== currentDocSlug"}):a.error?o.a.createElement(O.a,{error:a.error}):["Doc","Sheet","Table","Mind","Board","Show"].includes(a.type)?o.a.createElement("div",{className:r},o.a.createElement(j.a,null),"Doc"===a.type&&o.a.createElement(D,{key:"doc-content-".concat(a.id),editMode:M,group:i,book:c,doc:a,review:s,scene:"doc",isShare:u,showHeaderMeta:d,shouldRenderPager:l,shouldRenderComments:m,headingFolding:p,sidePanelManager:T,onCreateComment:N,onRemoveComment:G}),"Sheet"===a.type&&o.a.createElement(C,{key:"doc-content-".concat(a.id),editMode:M,history:e.history,match:e.match,group:i,book:c,doc:a,isShare:u,shouldRenderComments:m}),"Table"===a.type&&o.a.createElement(_,{key:"doc-content-".concat(a.id),editMode:M,history:e.history,match:e.match,group:i,book:c,doc:a,isShare:u,shouldRenderComments:m}),("Mind"===a.type||"Board"===a.type)&&o.a.createElement(k,{key:"doc-content-".concat(a.id),editMode:M,history:e.history,group:i,book:c,doc:a,isShare:u,dispatch:e.dispatch,shouldRenderComments:m}),"Show"===a.type&&o.a.createElement(E,{editMode:M,history:e.history,group:i,book:c,doc:a,isShare:u,dispatch:e.dispatch,shouldRenderComments:m}),o.a.createElement(h.a,{mark:"finish-doc-render"})):o.a.createElement(o.a.Fragment,null,a.content):o.a.createElement("span",{"data-testid":"none-currentDocSlug"}):o.a.createElement(R.a,{enableDelay:!0,delayTime:300})}P.propTypes={className:i.a.string,group:i.a.object.isRequired,book:i.a.object.isRequired,doc:i.a.object.isRequired,currentDocSlug:i.a.string.isRequired,currentBookSlug:i.a.string.isRequired,currentGroupSlug:i.a.string.isRequired,review:i.a.object,layout:i.a.oneOf(["center","adapt"]),isShare:i.a.bool,asideWrapperWidth:i.a.number,showHeaderMeta:i.a.bool,shouldRenderPager:i.a.bool,shouldRenderComments:i.a.bool,history:i.a.object,match:i.a.object,dispatch:i.a.func,headingFolding:i.a.bool},t.a=Object(g.b)(Object(u.withRouter)(Object(c.d)((function(e){return{review:e.review}}))(o.a.memo(P,(function(e,t){var r=["className","currentDocSlug","currentBookSlug","currentGroupSlug","book","doc","group","review","editMode","layout","isShare","showHeaderMeta","asideWrapperWidth","shouldRenderPager","shouldRenderComments","scene","headingFolding"];return s()(m.a.apply(void 0,[e].concat(r)),m.a.apply(void 0,[t].concat(r)))})))),!0)},5697:function(e,t,r){"use strict";r.r(t);var n=r(0),o=r.n(n),a=r(2),i=r.n(a),c=r(469),u=r(35),d=r(251),s=r(3637),l=r(65),m=r.n(l),p=r(787),b=new m.a("doc:share.page.vm");var g=function(e){var t=e.book,r=e.doc,n=e.query,o=e.slug,a=e.appData;return e.dispatch,n=p.a.normalizeReadPageQuery(n),b("process doc: ",o,n),{getQuery:function(){return n},isDocEmbed:function(){return"doc_embed"===n.view},isDocInner:function(){return"Doc"===r.type&&n.inner},isRenderSingleDoc:function(){return t.abilities&&!t.abilities.read},needRenderComments:function(){return r.loaded&&t.enable_comment&&!r.error},needRenderPager:function(){return r.loaded&&!a.isDocCollaborator}}},h=r(5),f=r.n(h),y=r(491),v=r.n(y),j=r(3493),O=r(4765),R="BookReader-module_wrapper_s6Jdt",S="BookReader-module_editMode_AQq00",w="BookReader-module_docTypographyClassic_tUB5r",E="BookReader-module_content_BGKYX",k="BookReader-module_docContainer_mQ3Tk",_="BookReader-module_sheetContainer_WtnSp";function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function D(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==C(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==C(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===C(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function P(e){var t,r=e.group,a=e.book,i=e.doc,c=e.isShare,u=e.showHeaderMeta,d=e.shouldRenderPager,s=void 0===d||d,l=e.scene,m=e.shouldRenderComments,b=e.dispatch,g=e.history,h=e.editMode,y=e.currentDocSlug,C=e.currentBookSlug,P=e.currentGroupSlug,q="classic"===p.a.getTheme(i,a).typography,M={Doc:k,Sheet:_,Mind:_,Show:_,Table:_};return Object(n.useEffect)((function(){var e=v()((function(e){i.loaded&&i.slug!==y||3!==e.eventPhase&&j.c.saveReadPosition(i.id)}),300);return window.addEventListener("scroll",e),function(){window.removeEventListener("scroll",e)}}),[i,y]),o.a.createElement("div",{className:f()([R],(t={},D(t,w,q),D(t,S,h&&"Doc"===i.type),t)),"data-testid":"content"},o.a.createElement("div",{className:E,id:"main"},o.a.createElement(O.a,{key:i.slug,className:M[i.type],doc:i,group:r,headingFolding:!0,book:a,isShare:c,history:g,scene:l,showHeaderMeta:u,shouldRenderPager:s,shouldRenderComments:m,dispatch:b,currentDocSlug:y,currentBookSlug:C,currentGroupSlug:P})))}P.propTypes={currentDocSlug:i.a.string.isRequired,currentBookSlug:i.a.string.isRequired,currentGroupSlug:i.a.string.isRequired,history:i.a.object.isRequired,group:i.a.object.isRequired,book:i.a.object.isRequired,doc:i.a.object.isRequired,editMode:i.a.bool,isShare:i.a.bool,showHeaderMeta:i.a.bool,shouldRenderPager:i.a.bool.isRequired,shouldRenderComments:i.a.bool.isRequired,scene:i.a.oneOf(["doc","other"]),dispatch:i.a.func};var q=o.a.memo(P);function M(){return M=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},M.apply(this,arguments)}var T=Object(d.b)((function(){return r.e(1539).then(r.bind(null,4983))}),{suspense:!0}),B=function(e){var t=e.book,r=e.location,n=e.doc,a=e.match.params,i=window.appData.sharePage,c=i?"doc_slug":"doc",d=Object(s.c)().editMode,l=Object(u.useParams)(),m=l.doc,p=l.group,b=l.book,h=g({book:t,doc:n,query:r.query,slug:a[c],appData:window.appData,dispatch:e.dispatch});return h.isRenderSingleDoc()?o.a.createElement(T,M({currentDocSlug:m,currentBookSlug:b,currentGroupSlug:p,editMode:d,shouldRenderComments:h.needRenderComments(),shouldRenderPager:h.needRenderPager(),isShare:i},e)):o.a.createElement(q,M({},e,{currentDocSlug:m,currentBookSlug:b,currentGroupSlug:p,scene:"doc",editMode:d,shouldRenderComments:h.needRenderComments(),shouldRenderPager:h.needRenderPager(),isShare:i}))};B.propTypes={group:i.a.object.isRequired,book:i.a.object.isRequired,doc:i.a.object.isRequired,location:i.a.object,match:i.a.object,history:i.a.object,dispatch:i.a.func};t.default=Object(c.d)((function(e){return{group:e.group,book:e.book,doc:e.doc}}))(Object(u.withRouter)(B))}}]);