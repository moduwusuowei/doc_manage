/*! For license information please see c__WordingCommentPanel.51e64e7a.async.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[1324],{3324:function(t,e,r){"use strict";var n=r(0),o=r.n(n),i=r(65),a=r.n(i),c=r(212),u=r.n(c),l=r(80),f=r.n(l),s=r(3339),p=r.n(s),y=r(3492),m=r(1726),d=r(3196),h=r(108),b=r(3489),v=r.n(b),g=r(3490),w=r.n(g),O=r(3482),j=r.n(O),_=r(3491),E=r(348),S=r(154),P=r(198),C=r(51);function x(t){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},x(t)}function k(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==x(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==x(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===x(i)?i:String(i)),n)}var o,i}var R,T=a()("editor:cache"),A=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.key=e}var e,r,n;return e=t,(r=[{key:"retrieve",value:function(){var t={format:null,value:null};T("[retrieve]key: ",this.key);var e=P.a.get(this.key);if(!e)return null;T("[retrieve]find text: ",e);var r=p.a.guessFormat(e);return t.format=r,t.value=e,T("[retrieve]doc: ",t),t}},{key:"put",value:function(t,e){T("[put]content cached: ","".concat(this.key," -> ").concat(t)),P.a.set(this.key,t)}},{key:"clear",value:function(){P.a.remove(this.key)}}])&&k(e.prototype,r),n&&k(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function L(t){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L(t)}function I(t){return function(t){if(Array.isArray(t))return N(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return N(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return N(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function G(){G=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var i=e&&e.prototype instanceof b?e:b,a=Object.create(i.prototype),c=new R(n||[]);return o(a,"_invoke",{value:P(t,r,c)}),a}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var p="suspendedStart",y="suspendedYield",m="executing",d="completed",h={};function b(){}function v(){}function g(){}var w={};l(w,a,(function(){return this}));var O=Object.getPrototypeOf,j=O&&O(O(T([])));j&&j!==r&&n.call(j,a)&&(w=j);var _=g.prototype=b.prototype=Object.create(w);function E(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==L(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function P(e,r,n){var o=p;return function(i,a){if(o===m)throw new Error("Generator is already running");if(o===d){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=C(c,n);if(u){if(u===h)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var l=s(e,r,n);if("normal"===l.type){if(o=n.done?d:y,l.arg===h)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=d,n.method="throw",n.arg=l.arg)}}}function C(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,C(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=s(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function T(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(L(e)+" is not iterable")}return v.prototype=g,o(_,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:v,configurable:!0}),v.displayName=l(g,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,l(t,u,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},E(S.prototype),l(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(f(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(_),l(_,u,"Generator"),l(_,a,(function(){return this})),l(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=T,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(u&&l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),k(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:T(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),h}},e}function D(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function M(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){D(i,n,o,a,c,"next",t)}function c(t){D(i,n,o,a,c,"throw",t)}a(void 0)}))}}function U(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,B(n.key),n)}}function F(t,e,r){return(e=B(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function B(t){var e=function(t,e){if("object"!==L(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==L(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===L(e)?e:String(e)}var V=a()("biz:lakex_mini_editor_base"),Y=(null===(R=window.appData)||void 0===R?void 0:R.me)||{},z=function(){function t(){var e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),F(this,"getDefaultSuggestions",(function(){return e.options.getDefaultSuggestions?e.options.getDefaultSuggestions():[]})),F(this,"setEngine",(function(t){e._engine=t,e.ocrListenerRemover=d.a.onEditorEngineLoaded(t,e.getType())})),F(this,"getEngine",(function(){return e._engine})),F(this,"setValue",(function(t){var r=t;t?t.startsWith("<")?(r={type:"lake",value:t},e._engine.setDocument(r)):"string"==typeof t&&(r={type:"json",value:JSON.parse(t)},e._engine.setDocument(r)):e._engine.setDocument()})),F(this,"getValue",(function(){return e._engine?e._engine.getPureContent():e.getDefaultValue()})),F(this,"isEmpty",(function(){return!e._engine||e._engine.isEmpty()})),F(this,"getSafetyValue",M(G().mark((function t(){return G().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.contentReady();case 2:return t.abrupt("return",e.getValue());case 3:case"end":return t.stop()}}),t)})))),F(this,"getHtml",(function(){return e._engine?e._engine.getPureHtml():null})),F(this,"focus",(function(t){if(!e._engine)return null;e._engine.focus(t)})),F(this,"contentReady",M(G().mark((function t(){var r,n;return G().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e._engine){t.next=2;break}return t.abrupt("return",null);case 2:return r=0,n=function t(n,o){e._engine.canGetDocument()?n():r>10?o():(r++,setTimeout((function(){t(n,o)}),1e3))},t.abrupt("return",new Promise(n));case 5:case"end":return t.stop()}}),t)})))),F(this,"saveAll",(function(){if(!e.options.disableCache){var t={format:f.a.FORMAT.LAKE,value:e.getValue(),html:e.getHtml()};e.saveToCache(t)}})),this.options=r,this.from=r.from||"reply",this.targetType=r.targetType,this.belong=r.belong,this.belongType=r.belongType,this.group=r.group,this.target=r.target,this.attachType=r.attachType,this.isEditMode=!!r.target,this.type=this.getType(),this.ctoken=Object(E.a)(window);var n=this.getCacheKey();this.cacheKeys={title:"".concat(n,"/title"),content:"".concat(n,"/content")},r.disableCache||(this.editorCache=new A(this.cacheKeys.content)),this.uuid=this.getUuid(),this._engine=null,this.ocrListenerRemover=null,this.initialDocument=null,this.init()}var e,r,n;return e=t,r=[{key:"init",value:function(){this.initialDocument=this.getInitialDocument(),V("init use: ",this.initialDocument)}},{key:"buildOptions",value:function(t){var e=this,r={translate:{supportTranslate:w()()},hideVipIcon:Object(_.a)(),board:{boardWebProxyParams:{webProxy:C.a,userId:null==Y?void 0:Y.id,spm:h,appData:window.appData}},image:{supportImgOCR:j()(),uploadFileURL:function(){return d.a.adaptOcrImageUploadUrl(e.getImageUploadUrl())},accept:Object(m.getImageAcceptArr)()},file:{hideEmbedButton:v()(),uploadFileURL:this.getFileUploadUrl(),accept:Object(m.getFileAcceptArr)(),localdocAccept:Object(m.getLocalDocAcceptArr)(),embedButtonStatus:Object(m.getIsDiabledPreviewAndEmbed)()},transfer:{transferFilesURL:this.getTransferUrl()},localdoc:{uploadFileURL:this.getFileUploadUrl(),accept:Object(m.getLocalDocAcceptArr)()},mention:{mentionURL:S.a.patchGroupIdToUrl(this.getMentionActionUrl()),defaultList:this.getDefaultSuggestions()},lockedtext:{action:this.getCryptoUrl()},placeholder:(null==t?void 0:t.placeholder)||this.getPlaceholder(),link:{autoCompleteLink:null==t?void 0:t.autoCompleteLink},video:{uploadAction:this.getMediaUploadUrl("video"),queryAction:"/api/video",accept:Object(m.getVideoAcceptArr)()},audio:{uploadFileURL:this.getMediaUploadUrl("audio"),queryURL:"/api/video",accept:Object(m.getAudioAcceptArr)()},vote:{allowVote:!0,queryDetailUrl:"api/votes",queryCheckUrl:"api/votes/mine",voteUrl:"api/votes"},yuque:{disableEmbedView:this.getDisableYuqueCardEmbedView()},materialLibrary:{component:o.a.createElement(y.a,{storage:P.a,webProxy:C.a})},fullscreen:{enable:this.getEnableFullEditor()}},n=[],i=this.getBlockedCards();return i&&i.length>1&&(n=Array.from(new Set([].concat(I(n),I(i))))),r.disabledPlugins=n,r}},{key:"getProps",value:function(){return{format:this.getFormat(),defaultValue:this.getDefaultValue(),autoFocus:this.getAutoFocus(),isMiniSize:this.isMiniSize()}}},{key:"getType",value:function(){return this.options.type||"unknown"}},{key:"getAutoFocus",value:function(){var t=this.options.autoFocus;return null!=t?t:!!this.options.useMiniGuide}},{key:"isMiniSize",value:function(){return!1}},{key:"getEnableFullEditor",value:function(){return!0}},{key:"getBlockedCards",value:function(){return["video","checkIn","vote","audio"]}},{key:"getUuid",value:function(){var t=this.cacheKeys.uuid,e=P.a.get(t);return e||(e=u()(32)+u()(32),P.a.set(t,e)),e}},{key:"getDefaultFormat",value:function(){return f.a.FORMAT.LAKE}},{key:"getFormat",value:function(){var t=this.options.format;return t||this.initialDocument.format}},{key:"getPlaceholder",value:function(){return this.options.placeholder}},{key:"getInitialDocument",value:function(){if(this.initialDocument)return this.initialDocument;var t=this.loadFromCache();if(V("cached document:",t),this.isEditMode){var e=this.getContentObject();return V("adapted content: ",e),t&&(V("merge with cached content",t),e.format=t.format||e.format,e.title=t.title||e.title,e.value=t.value||e.value),e}if(t)return t.format=t.format||this.getDefaultFormat(),t;var r=this.loadFromUrl();return r||{format:this.getDefaultFormat(),title:null,value:null}}},{key:"getContentObject",value:function(t){return{format:(t=t||this.target||{}).format||this.getDefaultFormat(),title:t.title||t.name||"",value:t.value||t.body_asl||t.content}}},{key:"getDefaultValue",value:function(){var t=this.options.defaultValue;return t||this.initialDocument.value}},{key:"getFullUrl",value:function(t){return this.isEditMode&&!this.options.useBelongAttach?"".concat(t,"&attachable_type=").concat(this.attachType,"&attachable_id=").concat(this.target.id,"&from=").concat(this.from):this.belong?"".concat(t,"&attachable_type=").concat(this.attachType,"&attachable_id=").concat(this.belong.id,"&from=").concat(this.from):null}},{key:"getTransferUrl",value:function(){return this.getFullUrl("/api/upload/copy?type=attachment")}},{key:"getFileUploadUrl",value:function(){var t="/api/upload/attach?ctoken=".concat(this.ctoken,"&type=attachment");return this.getFullUrl(t)}},{key:"getMediaUploadUrl",value:function(t){var e="/api/video?ctoken=".concat(this.ctoken,"&format=").concat(t);return this.getFullUrl(e)}},{key:"getImageUploadUrl",value:function(){var t=this.getFileUploadUrl();return t?t.replace("&type=attachment","&type=image"):null}},{key:"getMentionActionUrl",value:function(){var t="";return this.isEditMode&&!this.options.useBelongAttach?t="/api/users/complete?target_type=".concat(this.attachType,"&target_id=").concat(this.target.id):this.belong&&(t="/api/users/complete?target_type=".concat(this.attachType,"&target_id=").concat(this.belong.id)),t}},{key:"getCryptoUrl",value:function(){return"/api/services/crypto"}},{key:"getDisableYuqueCardEmbedView",value:function(){return this.options.disableYuqueCardEmbedView}},{key:"saveToCache",value:function(t){var e;V("save to cache:",t),t.format&&(t.title&&P.a.set(this.cacheKeys.title,t.title),this.needCacheContent(t)?null===(e=this.editorCache)||void 0===e||e.put(t.value,t.format):V("value is empty or the same as origin, ignore cache"))}},{key:"needCacheContent",value:function(t){if(this.options.disableCache)return!1;if(!t.value)return!1;var e;if(p.a.isBlank(t))return null===(e=this.editorCache)||void 0===e||e.clear(),!1;if(!this.target)return!0;var r=this.getContentObject();return!p.a.isContentSame(t.format,r.value,t.value)}},{key:"reset",value:function(){V("reset editor"),this.clearCache(),this._engine&&this._engine.setDocument()}},{key:"isContentChanged",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!t){var e=this.loadFromCache();e&&(t=e.value)}if(!this.target)return!0;var r="<cursor />";return this.target.body_asl.trim().replace(r,"")!==t.trim().replace(r,"")}},{key:"clearCache",value:function(){var t=this;V("clear cache"),Object.keys(this.cacheKeys).forEach((function(e){P.a.remove(t.cacheKeys[e])}))}},{key:"getCacheKey",value:function(){return this.isEditMode&&this.target&&this.belong?"autosave/".concat(this.type,"/").concat(this.belong.id,"/").concat(this.target.id,"/edit"):this.belong?"autosave/".concat(this.type,"/").concat(this.belong.id,"/new"):"autosave/".concat(this.type)}},{key:"loadFromUrl",value:function(){}},{key:"loadFromCache",value:function(){if(this.options.disableCache)return null;var t=!1,e={format:null,title:null,value:null},r=this.editorCache.retrieve();if(r&&(t=!0,e.format=r.format,e.value=r.value),this.cacheKeys.title){var n=P.a.get(this.cacheKeys.title);n&&(t=!0,e.title=n)}return t?e:null}},{key:"destroy",value:function(){var t;null===(t=this.ocrListenerRemover)||void 0===t||t.call(this)}}],n=[{key:"getEmptyDocument",value:function(){return{format:f.a.FORMAT.LAKE,value:null}}}],r&&U(e.prototype,r),n&&U(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();e.a=z},3387:function(t,e,r){"use strict";var n=r(67);function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(i=n.key,a=void 0,a=function(t,e){if("object"!==o(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(i,"string"),"symbol"===o(a)?a:String(a)),n)}var i,a}function a(){return a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=l(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},a.apply(this,arguments)}function c(t,e){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},c(t,e)}function u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=l(t);if(e){var i=l(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function l(t){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},l(t)}var f=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&c(t,e)}(s,t);var e,r,o,f=u(s);function s(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),f.apply(this,arguments)}return e=s,(r=[{key:"buildOptions",value:function(t){var e=a(l(s.prototype),"buildOptions",this).call(this,t);return e.disabledPlugins.push("mobile"),n.ua.mobile&&e.disabledPlugins.push("placeholder","slash"),e}},{key:"getBlockedCards",value:function(){return["video","audio","checkIn"]}}])&&i(e.prototype,r),o&&i(e,o),Object.defineProperty(e,"prototype",{writable:!1}),s}(r(3324).a);e.a=f},3415:function(t,e,r){"use strict";var n=r(80),o=r.n(n),i={_bookGrayscaleConfig:null,getDefaultDocumentFormat:function(t,e,r){return e=e||"",r=r||{},o.a.DOC_DEFAULT_FORMAT[t]||o.a.FORMAT.LAKE}};e.a=i},3536:function(t,e,r){"use strict";var n=r(211),o=r.n(n),i=r(52);function a(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var u={adaptAbilities:function(t){var e=t.me,r=t.comment,n=t.target_type,o=t.target,i={edit:!1,delete:!1};return e&&e.id===r.user_id?(i.edit=!0,i.delete=!0):"Doc"===n&&(i.delete=o.abilities&&o.abilities.destroy_comment),i},getPostActions:function(t,e){var r=[];return r.push({cmd:"copy_link",title:__("复制链接")}),r.push({cmd:"reply",title:__("评论")}),t.edit&&r.push({cmd:"edit",title:__("编辑")}),t.delete&&r.push({cmd:"delete",title:__("删除"),confirm:!0}),e&&r.push({cmd:"content_report",title:__("举报")}),r},includesHashAnchoredComment:function(t,e){if(!e||!e.startsWith("#comment-"))return!1;var r=parseInt(e.substring(9),10);return!!t.find((function(t){return t.id===r}))},getParticipants:function(t,e,r){var n=r.groupMembers,c=r.targetType,u=[];return"Doc"!==c&&"Resource"!==c||(t.contributors=t.contributors||[],u=a(t.contributors)),e&&e.length>0&&e.forEach((function(t){var e=u.find((function(e){return e&&t.user&&e.id===t.user.id}));t.user&&!e&&u.push(t.user)})),n&&n.length>0&&n.forEach((function(t){u.push(t.user)})),u=o()(u,"login"),window.appData.isYuque&&(u=u&&u.filter((function(t){return t.status!==i.STATUS.terminated}))),u},getAnchorId:function(t,e){return"comment-".concat(t)},TARGET_TYPES:["Doc","DocVersion","Resource","Artboard","Note"]};e.a=u},3542:function(t,e,r){"use strict";r.d(e,"c",(function(){return y})),r.d(e,"a",(function(){return w})),r.d(e,"m",(function(){return x})),r.d(e,"k",(function(){return V})),r.d(e,"i",(function(){return $})),r.d(e,"j",(function(){return rt})),r.d(e,"l",(function(){return lt})),r.d(e,"h",(function(){return ht})),r.d(e,"f",(function(){return jt})),r.d(e,"d",(function(){return xt})),r.d(e,"e",(function(){return It})),r.d(e,"g",(function(){return Bt})),r.d(e,"b",(function(){return Ht}));var n=r(80),o=r.n(n),i=r(3415),a=r(3324);function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function u(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==c(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==c(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===c(i)?i:String(i)),n)}var o,i}function l(t,e){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},l(t,e)}function f(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=s(t);if(e){var o=s(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===c(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function s(t){return s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},s(t)}var p=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}(c,t);var e,r,n,a=f(c);function c(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),a.apply(this,arguments)}return e=c,n=[{key:"getEmptyDocument",value:function(){return{format:o.a.FORMAT.LAKE,value:null}}}],(r=[{key:"getType",value:function(){var t=this.options.targetType;return t?"".concat(t,"_comment").toLowerCase():"comment"}},{key:"getCacheKey",value:function(){var t=this.options.replyId;return this.isEditMode&&this.target&&this.belong?"autosave/".concat(this.type,"/").concat(this.belong.id,"/").concat(this.target.id,"/edit"):this.belong?"autosave/".concat(this.type,"/").concat(this.belong.id,"/").concat(t,"/new"):"autosave/".concat(this.type)}},{key:"isMiniSize",value:function(){return this.options.useMiniGuide||this.options.isMiniSize||window.h5}},{key:"getDefaultFormat",value:function(){return i.a.getDefaultDocumentFormat()}},{key:"getEnableFullEditor",value:function(){return"Artboard"!==this.targetType}}])&&u(e.prototype,r),n&&u(e,n),Object.defineProperty(e,"prototype",{writable:!1}),c}(a.a),y=p;function m(t){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m(t)}function d(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==m(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==m(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===m(i)?i:String(i)),n)}var o,i}function h(t,e){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},h(t,e)}function b(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=v(t);if(e){var o=v(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===m(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function v(t){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},v(t)}var g=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&h(t,e)}(i,t);var e,r,n,o=b(i);function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),t.attachType="Resource",t.useBelongAttach=!0,t.from="reply",o.call(this,t)}return e=i,(r=[{key:"getType",value:function(){return"area_comment"}},{key:"getAutoFocus",value:function(){return!0}},{key:"isMiniSize",value:function(){return!0}}])&&d(e.prototype,r),n&&d(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(y),w=g;function O(t){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O(t)}function j(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==O(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==O(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===O(i)?i:String(i)),n)}var o,i}function _(){return _="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=P(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},_.apply(this,arguments)}function E(t,e){return E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},E(t,e)}function S(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=P(t);if(e){var o=P(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===O(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function P(t){return P=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},P(t)}var C=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&E(t,e)}(i,t);var e,r,n,o=S(i);function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),t.attachType="Doc",t.useBelongAttach=!0,t.from="reply",o.call(this,t)}return e=i,(r=[{key:"buildOptions",value:function(t){var e,r=_(P(i.prototype),"buildOptions",this).call(this,t);return r.image.showMiniToolbarWhen="never",null===(e=r.disabledPlugins)||void 0===e||e.push("slash"),r}},{key:"getType",value:function(){return"word_comment"}},{key:"getAutoFocus",value:function(){return!1}},{key:"isMiniSize",value:function(){return!0}},{key:"getEnableFullEditor",value:function(){return!1}}])&&j(e.prototype,r),n&&j(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(y),x=C,k=r(14),R=r.n(k),T=r(3387);function A(t){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},A(t)}function L(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function I(t,e,r){return(e=G(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function N(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,G(n.key),n)}}function G(t){var e=function(t,e){if("object"!==A(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==A(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===A(e)?e:String(e)}function D(t,e){return D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},D(t,e)}function M(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=U(t);if(e){var o=U(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===A(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function U(t){return U=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},U(t)}var F={daily:{title:"#prefix# #day# 日报汇总",content:'<!doctype lake><meta name="doc-version" content="1" /><p>建议 TL 每天组织日会，将一天的重点事项安排于此</p><p>每位同学下班前，在此提交日报</p><p><br /></p><p>日报不要记流水账，尽量在 200 字以内</p><p>重点项目或工作要及时总结和提报，尤其风险点要及时提报</p><p>可以写写思考和感想</p><p><br /></p><p>写完自己的日报，也看看大家的</p><p>每一位同学的努力，都值得认真阅读与交流</p><p><br /></p><p><span style="color: #FA541C;"><span>注意不要提及保密项目和敏感数据</span></span></p>'},weekly:{title:"#prefix# #day# 周报汇总",content:'<!doctype lake><meta name="doc-version" content="1" /><p>将一周的工作总结回复于此</p><p><br /></p><p>不要记流水账，尽量在 800 字以内</p><p>重点项目或工作要及时总结和提报，尤其风险点要及时提报</p><p>可以写写思考和感想</p><p><br /></p><p>写完自己的周报，也看看大家的</p><p>每一位同学的努力，都值得认真阅读与交流</p><p><br /></p><p><span style="color: #FA541C;"><span>注意不要提及保密项目和敏感数据</span></span></p>'},vote:{title:"一起来投票吧",content:'<!doctype lake><meta name="doc-version" content="1" /><card type="block" name="vote" value="data:%7B%22margin%22%3Atrue%2C%22id%22%3A%22jTHWG%22%2C%22type%22%3A%22single%22%7D"></card><p><br /><cursor /></p>'},default:{title:"",content:"<!doctype lake><p></p>"}},B=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&D(t,e)}(i,t);var e,r,n,o=M(i);function i(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),o.apply(this,arguments)}return e=i,n=[{key:"getTemplate",value:function(t,e){var r=F[t];if(!r)return{title:null,content:null};var n=R()(new Date).format("YYYY-MM-DD"),o=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?L(Object(r),!0).forEach((function(e){I(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},r);return o.title=o.title.replace("#prefix#",e),o.title=o.title.replace("#day#",n),o}}],(r=[{key:"getType",value:function(){return"thread"}},{key:"getMentionActionUrl",value:function(){return"/api/users/complete?target_type=Group&target_id=".concat(this.group.id)}},{key:"getFileUploadUrl",value:function(){var t="/api/upload/attach?ctoken=".concat(this.ctoken,"&type=attachment");return this.isEditMode?"".concat(t,"&attachable_type=").concat(this.attachType,"&attachable_id=").concat(this.target.id,"&from=").concat(this.from):this.belong?"".concat(t,"&attachable_type=").concat(this.belongType||"Book","&attachable_id=").concat(this.belong.id,"&from=").concat(this.from):this.group?"".concat(t,"&attachable_type=User&attachable_id=").concat(this.group.id,"&from=").concat(this.from):null}},{key:"getFileCopyUrl",value:function(){return this.isEditMode?"".concat("/api/upload/copy?type=attachment","&attachable_type=").concat(this.attachType,"&attachable_id=").concat(this.target.id,"&from=").concat(this.from):null}}])&&N(e.prototype,r),n&&N(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(T.a),V=B;function Y(t){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y(t)}function z(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==Y(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===Y(i)?i:String(i)),n)}var o,i}function K(t,e){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},K(t,e)}function q(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=W(t);if(e){var o=W(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===Y(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function W(t){return W=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},W(t)}var H=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&K(t,e)}(i,t);var e,r,n,o=q(i);function i(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),o.apply(this,arguments)}return e=i,(r=[{key:"getType",value:function(){return"thread_board"}},{key:"getAutoFocus",value:function(){return!0}},{key:"getMentionActionUrl",value:function(){return"/api/users/complete?target_type=Group&target_id=".concat(this.group.id)}},{key:"getFileUploadUrl",value:function(){var t="/api/upload/attach?ctoken=".concat(this.ctoken,"&type=attachment");return this.isEditMode&&!this.options.useBelongAttach?"".concat(t,"&attachable_type=").concat(this.attachType,"&attachable_id=").concat(this.target.id,"&from=").concat(this.from):this.belong?"".concat(t,"&attachable_type=").concat(this.belongType,"&attachable_id=").concat(this.belong.id,"&from=").concat(this.from):null}}])&&z(e.prototype,r),n&&z(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(a.a),$=H;function Z(t){return Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Z(t)}function J(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==Z(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Z(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===Z(i)?i:String(i)),n)}var o,i}function Q(t,e){return Q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Q(t,e)}function X(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=tt(t);if(e){var o=tt(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===Z(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function tt(t){return tt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tt(t)}var et=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Q(t,e)}(i,t);var e,r,n,o=X(i);function i(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),o.apply(this,arguments)}return e=i,(r=[{key:"getType",value:function(){return"thread_comment"}}])&&J(e.prototype,r),n&&J(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(y),rt=et;function nt(t){return nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nt(t)}function ot(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==nt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==nt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===nt(i)?i:String(i)),n)}var o,i}function it(){return it="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ut(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},it.apply(this,arguments)}function at(t,e){return at=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},at(t,e)}function ct(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=ut(t);if(e){var o=ut(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===nt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function ut(t){return ut=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ut(t)}var lt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&at(t,e)}(i,t);var e,r,n,o=ct(i);function i(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),t.attachType="User",t.useBelongAttach=!0,o.call(this,t)}return e=i,(r=[{key:"buildOptions",value:function(t){var e=it(ut(i.prototype),"buildOptions",this).call(this,t);return e.typography={mustTypography:"classic",typography:"classic",paragraphSpacing:"default"},e}},{key:"getType",value:function(){return"user_readme"}},{key:"getMentionActionUrl",value:function(){return"/api/users/complete"}},{key:"isMiniSize",value:function(){return this.options.small}},{key:"getAutoFocus",value:function(){return!0}}])&&ot(e.prototype,r),n&&ot(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(a.a);function ft(t){return ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ft(t)}function st(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==ft(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==ft(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===ft(i)?i:String(i)),n)}var o,i}function pt(){return pt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=dt(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},pt.apply(this,arguments)}function yt(t,e){return yt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},yt(t,e)}function mt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=dt(t);if(e){var o=dt(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===ft(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function dt(t){return dt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},dt(t)}var ht=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yt(t,e)}(i,t);var e,r,n,o=mt(i);function i(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),t.attachType="Doc",t.useBelongAttach=!0,t.disableCache=!0,t.from="table",o.call(this,t)}return e=i,(r=[{key:"buildOptions",value:function(t){var e=pt(dt(i.prototype),"buildOptions",this).call(this,t);return e.typography={mustTypography:"classic",typography:"classic",paragraphSpacing:"default"},this.options.scrollNode&&(e.scrollNode=this.options.scrollNode),e}},{key:"getType",value:function(){return"table_record_desc"}},{key:"getMentionActionUrl",value:function(){return"/api/users/complete"}},{key:"isMiniSize",value:function(){return this.options.small}},{key:"getAutoFocus",value:function(){return!1}},{key:"getInitialDocument",value:function(){return{format:this.getDefaultFormat(),title:null,value:null}}}])&&st(e.prototype,r),n&&st(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(a.a);function bt(t){return bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bt(t)}function vt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==bt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==bt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===bt(i)?i:String(i)),n)}var o,i}function gt(t,e){return gt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},gt(t,e)}function wt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Ot(t);if(e){var o=Ot(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===bt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function Ot(t){return Ot=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ot(t)}var jt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&gt(t,e)}(i,t);var e,r,n,o=wt(i);function i(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),t.from="group_custom",t.attachType="User",t.useBelongAttach=!0,o.call(this,t)}return e=i,(r=[{key:"getType",value:function(){return"group_custom"}},{key:"getMentionActionUrl",value:function(){return"/api/users/complete?target_type=Group&target_id=".concat(this.group.id)}},{key:"isMiniSize",value:function(){return this.options.small}},{key:"getAutoFocus",value:function(){return!0}}])&&vt(e.prototype,r),n&&vt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(a.a);function _t(t){return _t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_t(t)}function Et(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==_t(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==_t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===_t(i)?i:String(i)),n)}var o,i}function St(t,e){return St=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},St(t,e)}function Pt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Ct(t);if(e){var o=Ct(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===_t(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function Ct(t){return Ct=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ct(t)}var xt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&St(t,e)}(i,t);var e,r,n,o=Pt(i);function i(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i);var e=t.feedback;return t.attachType="User",t.useBelongAttach=!0,t.from="feedback",t.placeholder={tip:e&&e.abilities.manage?"你将要代表语雀回复用户，请使用官方口吻，慎重填写":"",emptyParagraphTip:""},o.call(this,t)}return e=i,(r=[{key:"getType",value:function(){return"feedback_comment"}},{key:"getCacheKey",value:function(){var t=this.getType();if(this.target)return"autosave/".concat(t,"/").concat(this.target.id,"/edit");var e=this.options.feedback;return e?"autosave/".concat(t,"/").concat(e.id,"/new"):"autosave/".concat(t)}},{key:"getContentObject",value:function(){var t=this.target.content||{source:"",format:"lake"};return{format:t.format,value:t.source||""}}},{key:"isMiniSize",value:function(){return!0}},{key:"getMentionActionUrl",value:function(){return"/api/users/complete"}},{key:"getAutoFocus",value:function(){return!0}}])&&Et(e.prototype,r),n&&Et(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(T.a);function kt(t){return kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kt(t)}function Rt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==kt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==kt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===kt(i)?i:String(i)),n)}var o,i}function Tt(t,e){return Tt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Tt(t,e)}function At(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Lt(t);if(e){var o=Lt(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===kt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function Lt(t){return Lt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Lt(t)}var It=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Tt(t,e)}(i,t);var e,r,n,o=At(i);function i(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),t.attachType="User",t.useBelongAttach=!0,t.placeholder={tip:"",emptyParagraphTip:""},t.from="feedback",o.call(this,t)}return e=i,(r=[{key:"getType",value:function(){return"feedback_remark"}},{key:"getContentObject",value:function(){return{format:"lake",value:this.target.remark||""}}},{key:"getCacheKey",value:function(){return this.target?"autosave/".concat(this.type,"/").concat(this.target.id):"autosave/".concat(this.type)}},{key:"getMentionActionUrl",value:function(){return"/api/users/complete"}},{key:"getAutoFocus",value:function(){return!0}},{key:"isMiniSize",value:function(){return!0}}])&&Rt(e.prototype,r),n&&Rt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(T.a);function Nt(t){return Nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Nt(t)}function Gt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==Nt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Nt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===Nt(i)?i:String(i)),n)}var o,i}function Dt(){return Dt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ft(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},Dt.apply(this,arguments)}function Mt(t,e){return Mt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Mt(t,e)}function Ut(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Ft(t);if(e){var o=Ft(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===Nt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function Ft(t){return Ft=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ft(t)}var Bt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Mt(t,e)}(i,t);var e,r,n,o=Ut(i);function i(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),t.target&&(t.attachType="Doclet"),o.call(this,t)}return e=i,(r=[{key:"getCards",value:function(){return this.options.target?Dt(Ft(i.prototype),"getCards",this).call(this):["label"]}},{key:"getFullCards",value:function(){return this.options.target?Dt(Ft(i.prototype),"getFullCards",this).call(this):["label"]}},{key:"getType",value:function(){return"org_board"}},{key:"getAutoFocus",value:function(){return!0}},{key:"getMentionActionUrl",value:function(){return"/api/users/complete"}},{key:"isMiniSize",value:function(){return!1}}])&&Gt(e.prototype,r),n&&Gt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(a.a);function Vt(t){return Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vt(t)}function Yt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==Vt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Vt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===Vt(i)?i:String(i)),n)}var o,i}function zt(){return zt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Wt(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},zt.apply(this,arguments)}function Kt(t,e){return Kt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Kt(t,e)}function qt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Wt(t);if(e){var o=Wt(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===Vt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function Wt(t){return Wt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Wt(t)}var Ht=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Kt(t,e)}(i,t);var e,r,n,o=qt(i);function i(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),t.attachType="Doclet",o.call(this,t)}return e=i,(r=[{key:"buildOptions",value:function(t){var e=zt(Wt(i.prototype),"buildOptions",this).call(this,t);return e.disabledPlugins=["collaboration","vote","checkIn","toc","dataTable","materialLibrary","okr"],e.typography={typography:"classic",paragraphSpacing:"relax"},e}},{key:"getType",value:function(){return"book_overview"}},{key:"isMiniSize",value:function(){return this.options.small}},{key:"getAutoFocus",value:function(){return!0}}])&&Yt(e.prototype,r),n&&Yt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(a.a)},3678:function(t,e,r){"use strict";var n,o=[{id:1,title:__("加油")},{id:2,title:__("开心")},{id:3,title:__("很忙")},{id:4,title:__("想哭")},{id:5,title:__("生气")}],i=(n={},o.forEach((function(t){n[t.id]=t})),n),a=[{id:"thumbs_up",title:__("支持"),icon:"https://gw.alipayobjects.com/zos/basement_prod/40dd7f62-e6ad-48c6-b2c1-aeed729ff753.svg"},{id:"thumbs_down",title:__("反对"),icon:"https://gw.alipayobjects.com/zos/basement_prod/49753f89-a52b-47f8-8dff-ca2b7d5ab29e.svg"},{id:"applause",title:__("喝彩"),icon:"https://gw.alipayobjects.com/zos/basement_prod/39b96288-777c-4ad9-8065-fe27ee2366d5.svg"},{id:"momo",title:__("摸摸"),icon:"https://gw.alipayobjects.com/zos/basement_prod/486defba-93e3-4151-8b23-6fb09dfb7f97.svg"},{id:"+1",title:__("+1"),icon:"https://gw.alipayobjects.com/zos/bmw-prod/cd3682d7-3cc9-44a1-87d3-1feb83baee73.svg"},{id:"OK",title:"OK",icon:"https://gw.alipayobjects.com/zos/bmw-prod/70ec25dc-2ad6-42f3-b802-76ba015becde.svg"}],c=function(){var t={};return a.forEach((function(e){t[e.id]=e})),t}(),u={REACTIONS:a,getMoodTitleById:function(t){return(i[t]||{}).title||""},getPostUrl:function(t){var e=window.location.hash||"",r=window.location.href;return r=r.substring(0,r.length-e.length),"".concat(r,"#comment-").concat(t)},classifyReactions:function(t){var e=Object.keys(c),r={};return e.forEach((function(t){r[t]={count:0,user_ids:[]}})),t.forEach((function(t){t.action_option.split(",").forEach((function(e){r[e]&&(r[e].count++,r[e].user_ids.push(t.user_id))}))})),r},getReactionById:function(t){return c[t]}};e.a=u},3752:function(t,e,r){},3849:function(t,e,r){"use strict";r.d(e,"b",(function(){return l})),r.d(e,"a",(function(){return u}));var n=r(0),o=r.n(n),i=r(2),a=r(154),c={bookTips:"index-module_bookTips_cZ25F",groupTips:"index-module_groupTips_znta0",commentTips:"index-module_commentTips_eS4uK"};function u(t){var e=t.targetType,r=o.a.createElement("a",{href:"https://www.yuque.com/yuque/cdgcvd/zsw0w0",className:"wording-comment-link",target:"_blank",style:{marginLeft:"8px"}},__("了解更多"));switch(e){case"Book":return o.a.createElement("span",{className:c.bookTips,"data-testid":"forbid-tip"},__("注册 7 天后可设置为互联网可见 {learnMoreLink}",{learnMoreLink:r}));case"Group":return o.a.createElement("div",{className:c.groupTips,"data-testid":"forbid-tip"},__("注册 7 天后，即可创建知识小组 {learnMoreLink}",{learnMoreLink:r}));default:return o.a.createElement("span",{className:c.commentTips,"data-testid":"forbid-tip"},__("注册 7 天后即可参与评论 {learnMoreLink}",{learnMoreLink:r}))}}function l(t,e){var r,n=window.appData,o=n.settings,i=void 0===o?{}:o,c=n.organization,u=n.isPublicCloud,l=e||{},f=l.me,s=void 0===f?window.appData.me||{}:f,p=l.group,y=void 0===p?window.appData.group:p,m=c&&c.id;y&&a.a.isGroupOrPublication(y)&&(r=y.abilities&&y.abilities.read_private);var d=t&&t.abilities&&t.abilities.update;return!!(u&&!m&&i.enable_new_user_public_ability_forbid&&s.isNewbie&&!r&&!d)}u.propTypes={targetType:i.PropTypes.string}},3873:function(t,e,r){"use strict";r(782);var n=r(379),o=r(0),i=r.n(o),a=r(2),c=r.n(a),u=r(5),l=r.n(u);r(3752);function f(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return s(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return s(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function p(t){var e=t.reaction,r=t.users,a=t.myReaction,c=f(Object(o.useState)(!1),2),u=c[0],s=c[1];return i.a.createElement(n.a,{className:"post-reaction-detail",overlayClassName:"post-reaction-detail-popover",getPopupContainer:function(t){return t.parentNode},mouseEnterDelay:.618,trigger:["hover"],placement:"bottomLeft",onVisibleChange:function(r){s(r),!1===r?t.reset(e.id):t.loadUsers(e.id)},visible:u,content:i.a.createElement("ul",{className:"post-reaction-users"},r.map((function(t){return i.a.createElement("li",{key:t.id},i.a.createElement("a",{href:"/".concat(t.login),target:"_blank"},t.name))})))},i.a.createElement("div",{onClick:t.onReactionClick,className:l()({"post-reaction-detail-type":!0,"post-reaction-detail-active":a&&a.reaction_types&&a.reaction_types.includes(e.id)})},i.a.createElement("img",{className:"post-interaction-icon",src:e.icon,height:20}),i.a.createElement("span",{className:"post-interaction-num"},t.total)))}p.defaultProps={onReactionClick:function(){}},p.propTypes={myReaction:c.a.object,users:c.a.array.isRequired,total:c.a.number.isRequired,reaction:c.a.object.isRequired,loadUsers:c.a.func.isRequired,reset:c.a.func.isRequired,onReactionClick:c.a.func},e.a=p},3874:function(t,e,r){"use strict";r(782);var n=r(379),o=r(0),i=r.n(o),a=r(2),c=r.n(a),u=r(3678),l=r(45);r(3752);function f(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return s(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return s(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var p=u.a.REACTIONS;function y(t){var e=t.active,r=t.totalReaction,a=t.reactionIcon,c=f(Object(o.useState)(!1),2),u=c[0],s=c[1];return i.a.createElement("div",{className:"post-reaction"},i.a.createElement(n.a,{getPopupContainer:function(t){return t.parentNode},trigger:window.h5?["click"]:["hover"],placement:t.placement,autoAdjustOverflow:!1,visible:u,arrowPointAtCenter:!0,onVisibleChange:function(t){s(t)},content:i.a.createElement("div",null,i.a.createElement("ul",{className:"post-reaction-items"},p.map((function(r){return i.a.createElement("li",{className:e.includes(r.id)?"post-reaction-active":"",key:r.id},i.a.createElement("img",{src:r.icon,onClick:function(){var n;n=r,e.includes(n.id)?t.onCancelReaction(n.id):t.onReaction(n.id),t.onReactionUpdate(n),s(!1)}}))}))))},i.a.createElement("div",null,i.a.createElement("span",{className:"post-reaction-entry"},a||i.a.createElement(l.b,{name:"comment-reaction",width:20,height:20})),r>0&&i.a.createElement("span",{className:"post-interaction-action-total"},r))))}y.defaultProps={onReactionUpdate:function(){}},y.propTypes={active:c.a.array,onReaction:c.a.func.isRequired,onCancelReaction:c.a.func.isRequired,onReactionUpdate:c.a.func,totalReaction:c.a.number,reactionIcon:c.a.element,placement:c.a.string},e.a=y},3875:function(t,e,r){"use strict";var n=r(0),o=r(65),i=r.n(o),a=r(117);function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function u(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function l(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==c(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==c(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===c(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function f(t){return function(t){if(Array.isArray(t))return y(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||p(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||p(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){if(t){if("string"==typeof t)return y(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(t,e):void 0}}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var m=new i.a("thread:post.port");e.a=function(t){var e=t.me,r=t.comment,o=t.onReactionUpdate,i=s(Object(n.useState)(r.reactions||[]),2),c=i[0],p=i[1],y=s(Object(n.useState)({}),2),d=y[0],h=y[1],b=s(Object(n.useState)(!1),2),v=b[0],g=b[1],w="Comment";Object(n.useEffect)((function(){p(r.reactions||[])}),[r]);var O=function(){var t=null;return e&&e.id&&(t=c.find((function(t){return t.user_id===e.id})))&&(t.reaction_types=t.action_option.split(",")),t},j=function(t){return a.webProxy.actions.create({target_id:r.id,target_type:w,action_type:"reaction",action_option:t}).then((function(r){m("success",r);var n=c.filter((function(t){return t.user_id!==e.id}));n.push({user_id:e.id,action_type:"reaction",action_option:t}),p(n),o&&o(n,{actionType:"create",userId:e.id,actionOption:t})}))};return{state:{reactions:c,reactionUserMap:d},reaction:function(t){m("reaction",t);var e=t,r=O();if(r){var n=f(r.reaction_types);if(n.includes(t))return Promise.resolve({});n.push(t),e=n.join(",")}return j(e)},cancelReaction:function(t){m("cancel reaction:",t);var n=O();if(!n)return Promise.resolve({});var i=n.reaction_types.filter((function(e){return e!==t}));if(i.length>0){var u=i.join(",");return m("update action_option",i.join(",")),j(u)}return a.webProxy.actions.destroy({target_id:r.id,target_type:w,action_type:"reaction"}).then((function(){var r=c.filter((function(t){return t.user_id!==e.id}));p(r),o&&o(r,{actionType:"delete",userId:e.id,reactionType:t})}))},loadReactionUser:function(t){m("load users for reaction",t),v||(g(!0),a.webProxy.actions.users({target_id:r.id,target_type:w,action_type:"reaction",action_option:"".concat(t),limit:30}).then((function(e){var r=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?u(Object(r),!0).forEach((function(e){l(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},d);r[t]=e,g(!1),h(r)})))},resetReactionUser:function(t){h({})},getMyReaction:O}}},3994:function(t,e,r){"use strict";r.d(e,"b",(function(){return p})),r.d(e,"a",(function(){return l}));var n=r(72);function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(i=n.key,a=void 0,a=function(t,e){if("object"!==o(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(i,"string"),"symbol"===o(a)?a:String(a)),n)}var i,a}function a(t,e){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},a(t,e)}function c(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=u(t);if(e){var i=u(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function u(t){return u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},u(t)}var l={SCROLL:"SCROLL"},f=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&a(t,e)}(u,t);var e,r,n,o=c(u);function u(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),o.apply(this,arguments)}return e=u,r&&i(e.prototype,r),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(r.n(n).a),s=new f;function p(){return s}},5725:function(t,e,r){"use strict";r.r(e);var n=r(0),o=r.n(n),i=r(62),a=r.n(i),c=r(469),u=r(5),l=r.n(u),f=r(45),s=(r(41),r(10)),p=r(2),y=r.n(p),m=r(491),d=r.n(m),h=r(3994),b=(r(42),r(9)),v=r(80),g=r.n(v),w=r(372),O=r.n(w),j=r(3542),_=r(3849),E=r(251),S="Creator-module_createContainer_E9WwG",P="Creator-module_createBox_YJGH6",C="Creator-module_editorContainer_N1BzF",x="Creator-module_actions_CFe4H",k="Creator-module_actionItem_NsFQU",R="Creator-module_cancel_G++6L";function T(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return A(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return A(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var L=Object(E.b)((function(){return Promise.all([r.e(4),r.e(5),r.e(6),r.e(0),r.e(1236)]).then(r.bind(null,3863))}),{suspense:!0}),I={};function N(t){var e=I.useViewModel(t),r=e.state,n=Object(_.b)(t.doc);return o.a.createElement("div",{ref:r.creatorRef,className:S,"data-testid":"comment-creator",style:{position:"absolute",top:"".concat(r.offsetTop,"px")}},o.a.createElement("div",{className:P},o.a.createElement("div",{className:C},o.a.createElement(L,{editor:e.editor,onChange:e.onContentChange,onSubmit:e.createReply,onLoad:e.onLoad})),o.a.createElement("div",{className:x},o.a.createElement("div",{className:k},o.a.createElement(b.a,{type:"primary",disabled:r.isEmpty||r.loading||n,onClick:e.createReply},__("评论"))),o.a.createElement("div",{className:k},o.a.createElement(b.a,{className:R,onClick:e.cancelComment},__("取消")))),n&&o.a.createElement(_.a,null)))}I.useViewModel=function(t){var e=t.doc,r=t.selectedInfo,o=t.groupPosition,i=t.createComment,a=t.cancelComment,c=t.updateGroupPosition,u=t.getDefaultGroupArr,l=t.getDefaultPosition,f=t.getOffsetTop,s=t.transformAllGroup,p=t.clearAllGroupTransform,y=Object(n.useRef)(null),m=T(Object(n.useState)(!0),2),h=m[0],b=m[1],v=T(Object(n.useState)(!1),2),w=v[0],_=v[1],E=Object(n.useMemo)((function(){return new j.m({belong:e,placeholder:__("请添加评论...")})}),[e.id]),S=r.drawRanges[0],P=S.commentId,C=u(o),x=f(C,P);return Object(n.useEffect)((function(){var t=new ResizeObserver(d()((function(){var t=l(S),e=t.x,r=t.y;c({id:P,left:e,top:r,height:y.current.getBoundingClientRect().height});var n=u(o),i=f(n,P);i!==r?s(r-i):p()}),50));return t.observe(y.current),function(){t.disconnect()}}),[r]),Object(n.useEffect)((function(){setTimeout((function(){E.focus(!1)}),500)}),[r]),{state:{creatorRef:y,doc:e,isEmpty:h,loading:w,offsetTop:x},onContentChange:function(){b(E.isEmpty())},onLoad:function(){b(E.isEmpty())},createReply:function(){_(!0),E.contentReady().then((function(){E.isEmpty()||(i({commentable_type:"Doc",commentable_id:e.id,type:O.a.TYPE.WORDING_COMMENT,body_asl:E.getValue(),body:E.getHtml(),format:g.a.FORMAT.LAKE,selection:{paragraph_id:r.paragraphId,text_offset:r.textOffset,text:r.text,selection_range:{start:r.start,end:r.end}}}),E.reset(),_(!1))}))},cancelComment:a,editor:E}},N.propTypes={doc:y.a.object,selectedInfo:y.a.object,groupPosition:y.a.object,createComment:y.a.func,cancelComment:y.a.func,updateGroupPosition:y.a.func,getDefaultGroupArr:y.a.func,getDefaultPosition:y.a.func,getOffsetTop:y.a.func,transformAllGroup:y.a.func,clearAllGroupTransform:y.a.func};var G=N,D=r(3851),M=r(362),U=r(51),F=function(t,e){var r=t.doc_id,n=t.selection_id,o=Object(M.a)(U.a.docSelections.updateVisible).request;return{openSelection:function(t){return o({doc_id:r,selection_id:n,visible:!0}).then((function(){e({type:"litecomment/openSelectionById",payload:{selection_id:n,doc_id:r}}),t&&t()}))},closeSelection:function(t,i){return o({doc_id:r,selection_id:n,visible:!1}).then((function(){e({type:"litecomment/closeSelectionById",payload:{selection_id:n,doc_id:r}}),i&&i()}))}}};function B(t){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},B(t)}function V(){V=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var i=e&&e.prototype instanceof b?e:b,a=Object.create(i.prototype),c=new R(n||[]);return o(a,"_invoke",{value:P(t,r,c)}),a}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var p="suspendedStart",y="suspendedYield",m="executing",d="completed",h={};function b(){}function v(){}function g(){}var w={};l(w,a,(function(){return this}));var O=Object.getPrototypeOf,j=O&&O(O(T([])));j&&j!==r&&n.call(j,a)&&(w=j);var _=g.prototype=b.prototype=Object.create(w);function E(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==B(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function P(e,r,n){var o=p;return function(i,a){if(o===m)throw new Error("Generator is already running");if(o===d){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=C(c,n);if(u){if(u===h)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var l=s(e,r,n);if("normal"===l.type){if(o=n.done?d:y,l.arg===h)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=d,n.method="throw",n.arg=l.arg)}}}function C(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,C(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=s(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function T(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(B(e)+" is not iterable")}return v.prototype=g,o(_,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:v,configurable:!0}),v.displayName=l(g,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,l(t,u,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},E(S.prototype),l(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(f(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(_),l(_,u,"Generator"),l(_,a,(function(){return this})),l(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=T,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(u&&l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),k(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:T(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),h}},e}function Y(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}var z=function(t){var e=Object(n.useContext)(D.a),r=function(){var r,n=(r=V().mark((function r(n){var o;return V().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t({type:"proxy.web/comments.create",payload:{data:n}});case 2:if((o=r.sent).id){r.next=5;break}return r.abrupt("return");case 5:return r.next=7,t({type:"litecomment/create",payload:{data:o,showEditorAtBottom:!0,commentListStyle:"floor"}});case 7:return null==e||e.createComment(o),t({type:"doc/addCommentCount"}),r.abrupt("return",o);case 10:case"end":return r.stop()}}),r)})),function(){var t=this,e=arguments;return new Promise((function(n,o){var i=r.apply(t,e);function a(t){Y(i,n,o,a,c,"next",t)}function c(t){Y(i,n,o,a,c,"throw",t)}a(void 0)}))});return function(t){return n.apply(this,arguments)}}();return{createComment:r,updateComment:function(r,n){return t({type:"proxy.web/comments.update",payload:{data:r}}).then((function(){n&&n(),t({type:"litecomment/updateOne",payload:r}),null==e||e.updateComment(r)}))},deleteComment:function(r,n){return t({type:"proxy.web/comments.destroy",payload:{data:{id:r},reducer:"litecomment/remove"}}).then((function(){t({type:"doc/reduceCommentCount"}),n&&n(),null==e||e.destroyComment({id:r})}))}}},K=(r(151),r(66)),q=(r(782),r(379)),W=(r(176),r(64)),H=(r(489),r(98)),$=r(958),Z=r.n($),J=r(3875),Q=r(3678),X=r(3874),tt=r(3536),et=r(3663),rt=r(260),nt=r(3820),ot=r(490),it=r(3873),at=Q.a.REACTIONS;function ct(t){var e=t.comment,r=t.onReactionUpdate,n=t.reactionMap,i=t.reactions,a=t.myReaction,c=t.reactionViewModel,u=t.reactionUserMap;return i.length>0?o.a.createElement("div",{className:"post-interaction",style:{marginTop:12}},o.a.createElement("div",{className:"post-interaction-reaction-summary"},o.a.createElement("ul",null,at.map((function(t){var i=n[t.id].count;return 0===i?null:o.a.createElement("li",{key:t.id},o.a.createElement(it.a,{myReaction:a,reaction:t,users:u[t.id]||[],total:i,loadUsers:function(){c.loadReactionUser(t.id)},reset:function(){c.resetReactionUser(t.id)},onReactionClick:function(){var n;(null!=a&&null!==(n=a.action_option)&&void 0!==n&&n.includes.includes(t.id)?c.cancelReaction(t.id):c.reaction(t.id)).then((function(){c.loadReactionUser(t.id),r(t,e)}))}}))}))))):null}ct.defaultProps={onReactionUpdate:function(){}},ct.propTypes={comment:y.a.object.isRequired,onReactionUpdate:y.a.func,reactionMap:y.a.object.isRequired,reactions:y.a.array.isRequired,myReaction:y.a.object.isRequired,reactionViewModel:y.a.object.isRequired,reactionUserMap:y.a.object.isRequired};var ut=ct,lt={editorViewContainer:"EditView-module_editorViewContainer_tCK3o",actions:"EditView-module_actions_TAmbV",actionItem:"EditView-module_actionItem_wxvcy",cancel:"EditView-module_cancel_i+xST"};function ft(t){return ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ft(t)}function st(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function pt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?st(Object(r),!0).forEach((function(e){yt(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):st(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function yt(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==ft(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==ft(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===ft(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function mt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return dt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return dt(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function dt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var ht=Object(E.b)((function(){return Promise.all([r.e(4),r.e(5),r.e(6),r.e(0),r.e(1236)]).then(r.bind(null,3863))}),{suspense:!0}),bt={};function vt(t){var e=bt.useViewModel(t),r=e.state;return o.a.createElement("div",{className:lt.editorViewContainer},o.a.createElement("div",{className:lt.editorWrapper},o.a.createElement(ht,{editor:e.editor,onChange:e.onContentChange,onSubmit:e.update})),o.a.createElement("div",{className:lt.actions},o.a.createElement("div",{className:lt.actionItem},o.a.createElement(b.a,{type:"primary","data-testid":"comment-edit-submit",disabled:r.isEmpty||r.loading,onClick:e.update},__("确定"))),o.a.createElement("div",{className:lt.actionItem},o.a.createElement(b.a,{className:lt.cancel,onClick:e.cancelEdit},__("取消")))))}bt.useViewModel=function(t){var e=t.comment,r=t.cancelEdit,o=t.updateComment,i=t.doc,a=mt(Object(n.useState)(!1),2),c=a[0],u=a[1],l=mt(Object(n.useState)(!1),2),f=l[0],s=l[1],p=Object(n.useMemo)((function(){return new j.m({target:e,belong:i})}),[i.id]);return{state:{doc:i,comment:e,isEmpty:c,loading:f},update:function(){s(!0),p.contentReady().then((function(){o(pt(pt({},e),{},{body_asl:p.getValue(),body:p.getHtml(),format:g.a.FORMAT.LAKE}))}))},onContentChange:function(){u(p.isEmpty())},cancelEdit:r,editor:p}},vt.propTypes={comment:y.a.object,cancelEdit:y.a.func,updateComment:y.a.func};var gt=vt,wt={groupItemContainer:"CommentGroupItem-module_groupItemContainer_hcFs5",avatar:"CommentGroupItem-module_avatar_sZcW2",main:"CommentGroupItem-module_main_LL-Xw",name:"CommentGroupItem-module_name_9c70h",arrow:"CommentGroupItem-module_arrow_u0PYm",time:"CommentGroupItem-module_time_KbowO",content:"CommentGroupItem-module_content_KAu25",actions:"CommentGroupItem-module_actions_eyLP8",moreAction:"CommentGroupItem-module_moreAction_l2lcj",actionItem:"CommentGroupItem-module_actionItem_C4Epa",withoutMarginRight:"CommentGroupItem-module_withoutMarginRight_Z0YBO",replyContainer:"CommentGroupItem-module_replyContainer_R7zLP",editContainer:"CommentGroupItem-module_editContainer_qHYQX"};function Ot(t){return Ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ot(t)}function jt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function _t(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?jt(Object(r),!0).forEach((function(e){Et(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):jt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Et(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==Ot(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Ot(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===Ot(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function St(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Pt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Pt(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Pt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Ct=Object(E.b)((function(){return Promise.all([r.e(4),r.e(5),r.e(6),r.e(0),r.e(1241)]).then(r.bind(null,2948))}),{suspense:!0}),xt={useViewModel:function(t){var e=t.comment,r=t.deleteComment,o=t.updateComment,i=t.me,a=t.doc,c=t.visibility,u=t.index,l=t.reply,f=t.dispatch,p=Object(n.useContext)(D.a),y=St(Object(n.useState)("view"),2),m=y[0],d=y[1],h=St(Object(n.useState)(!0),2),b=h[0],v=h[1],g=Object(J.a)({me:i,comment:e,onReactionUpdate:function(t,r){var n=_t(_t({},e),{},{reactions:t});f({type:"litecomment/updateOne",payload:n}),null==p||p.updateReaction(null,n,r)}}),O=g.state,j=O.reactions,_=O.reactionUserMap,E=Object(n.useMemo)((function(){var t={reactionMap:Q.a.classifyReactions(j),myReaction:g.getMyReaction(),totalReaction:0};return Object.keys(t.reactionMap).forEach((function(e){t.totalReaction+=t.reactionMap[e].count})),t}),[j]),S=E.reactionMap,P=E.myReaction,C=void 0===P?{}:P,x=!(!i||!i.id);return Object(n.useEffect)((function(){c&&v(!1)}),[c]),{state:{doc:a,me:i,comment:e,loading:b,mode:m,hasLogin:x,index:u,reactionMap:S,myReaction:C,reactions:j,reactionUserMap:_},reactionViewModel:g,deleteComment:function(){r(e.id)},update:function(t){o(t),d("view")},edit:function(){d("edit")},cancelEdit:function(){d("view")},replyTo:function(){return l(e)},canDelete:function(){return!!i&&(i.id===e.user_id||a.abilities&&a.abilities.destroy_comment)},canEdit:function(){return i&&i.id===e.user_id},canReport:function(){if(!window.appData.isPublicCloud)return!1;var t=Object(et.a)()||Object(et.b)();return e.status===w.STATUS.normal&&t&&i&&i.id!==e.user_id},copyLink:function(t){try{Z()(t),s.a.success(__("评论链接已复制"))}catch(t){}},onReactionUpdate:function(){}}}},kt=function(t){var e=t.state.comment,r=tt.a.getAnchorId(e.id),n=window.location,i=n.protocol,a=n.host,c=n.pathname,u="".concat(i,"//").concat(a).concat(c,"#").concat(r);return o.a.createElement(H.a,null,o.a.createElement(H.a.Item,{key:"copy"},o.a.createElement("span",{onClick:function(){t.copyLink(u)}},__("复制评论链接"))),t.canReport()&&o.a.createElement(H.a.Item,{key:"report"},o.a.createElement(nt.a,{targetId:e.id,targetType:"Comment"},(function(t){return o.a.createElement("span",{className:"action-link",onClick:t.onShowPanel},__("举报"))}))))},Rt=function(t){var e=xt.useViewModel(t),r=e.reactionViewModel,n=e.onReactionUpdate,i=e.state,a=i.index,c=i.comment,u=i.loading,s=i.mode,p=i.hasLogin,y=i.doc,m=i.reactionMap,d=i.myReaction,h=i.reactions,b=i.reactionUserMap,v=c.user,g=c.to_user,w=o.a.createRef();if("view"===s){var O=l()("comment-item-".concat(a),wt.groupItemContainer);return o.a.createElement(o.a.Fragment,null,c&&null===c.deleted_at&&o.a.createElement("div",{className:O,"data-testid":"comment-item",ref:w},o.a.createElement("div",{className:wt.avatar},o.a.createElement(ot.a,{src:v&&v.avatar_url,size:24,name:v.name})),o.a.createElement("div",{className:wt.main},o.a.createElement("div",{className:wt.info},o.a.createElement("div",{className:wt.name},o.a.createElement("span",null,v.name),g&&o.a.createElement(o.a.Fragment,null,o.a.createElement(f.b,{className:wt.arrow,name:"review-arrow-right",size:16}),o.a.createElement("span",null,g.name))),o.a.createElement("div",{className:wt.time},o.a.createElement(rt.a,{time:c.created_at}))),o.a.createElement("div",{className:wt.content},!u&&o.a.createElement(Ct,{id:c.id,content:c.body_asl,genOutline:!1,genAnchor:!1,simpleUI:!0})),p&&o.a.createElement(ut,{comment:c,onReactionUpdate:n,reactionViewModel:r,myReaction:d,reactionMap:m,reactions:h,reactionUserMap:b}),p&&o.a.createElement("div",{className:wt.actions},o.a.createElement("span",{className:wt.actionItem,onClick:e.replyTo},o.a.createElement(f.b,{name:"comment-bubble",color:"#8C8C8C",width:16,height:16})),o.a.createElement(X.a,{reactionIcon:o.a.createElement("span",{className:l()(wt.actionItem,wt.withoutMarginRight)},o.a.createElement(f.b,{className:wt.action,name:"comment-reaction",color:"#8C8C8C",width:16,height:16})),active:(null==d?void 0:d.reaction_types)||[],onReaction:r.reaction,onCancelReaction:r.cancelReaction,onReactionUpdate:function(t){return n(t,c)}}),o.a.createElement("span",{className:wt.moreAction},e.canEdit()&&o.a.createElement("span",{className:wt.actionItem,onClick:e.edit},o.a.createElement(f.b,{name:"edit-border",color:"#8C8C8C",width:16,height:16})),e.canDelete()&&o.a.createElement(W.a,{title:__("确认删除该评论么？"),placement:"bottom",onConfirm:e.deleteComment},o.a.createElement("span",{className:wt.actionItem},o.a.createElement(f.b,{name:"icon-delete",color:"#8C8C8C",width:16,height:16}))),o.a.createElement(q.a,{type:"menu",getPopupContainer:function(t){return t.parentNode},placement:"bottomRight",arrowPointAtCenter:!0,trigger:["hover"],content:kt(e)},o.a.createElement("span",{className:wt.actionItem},o.a.createElement(f.b,{name:"comment-more",color:"#8C8C8C",width:16,height:16}))))))))}return o.a.createElement("div",{style:{paddingLeft:16,paddingRight:16}},o.a.createElement(gt,{doc:y,comment:c,cancelEdit:e.cancelEdit,updateComment:e.update}))};Rt.propTypes={index:y.a.number,comment:y.a.object,me:y.a.object,doc:y.a.object,rootComment:y.a.object,deleteComment:y.a.func,updateComment:y.a.func,highlight:y.a.func,reply:y.a.func,dispatch:y.a.func};var Tt=Rt,At="ReplyCreator-module_replyCreatorContainer_NQ4sK",Lt="ReplyCreator-module_editorContainer_Tvxsn",It="ReplyCreator-module_actions_pnqDv",Nt="ReplyCreator-module_actionItem_UHAql",Gt="ReplyCreator-module_cancel_ARRnU",Dt="ReplyCreator-module_replyingInfo_RH86T",Mt="ReplyCreator-module_wrapper_uNAur",Ut="ReplyCreator-module_name_Pay8V";function Ft(t){return Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ft(t)}function Bt(){Bt=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var i=e&&e.prototype instanceof b?e:b,a=Object.create(i.prototype),c=new R(n||[]);return o(a,"_invoke",{value:P(t,r,c)}),a}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var p="suspendedStart",y="suspendedYield",m="executing",d="completed",h={};function b(){}function v(){}function g(){}var w={};l(w,a,(function(){return this}));var O=Object.getPrototypeOf,j=O&&O(O(T([])));j&&j!==r&&n.call(j,a)&&(w=j);var _=g.prototype=b.prototype=Object.create(w);function E(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==Ft(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function P(e,r,n){var o=p;return function(i,a){if(o===m)throw new Error("Generator is already running");if(o===d){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=C(c,n);if(u){if(u===h)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var l=s(e,r,n);if("normal"===l.type){if(o=n.done?d:y,l.arg===h)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=d,n.method="throw",n.arg=l.arg)}}}function C(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,C(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=s(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function T(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Ft(e)+" is not iterable")}return v.prototype=g,o(_,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:v,configurable:!0}),v.displayName=l(g,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,l(t,u,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},E(S.prototype),l(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(f(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(_),l(_,u,"Generator"),l(_,a,(function(){return this})),l(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=T,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(u&&l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),k(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:T(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),h}},e}function Vt(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Yt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return zt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zt(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Kt=Object(E.b)((function(){return Promise.all([r.e(4),r.e(5),r.e(6),r.e(0),r.e(1236)]).then(r.bind(null,3863))}),{suspense:!0});function qt(t){var e=t.doc,r=t.createComment,o=t.replyingTo,i=t.parent_id,a=t.root_id,c=t.cancelReply,u=Yt(Object(n.useState)(!0),2),l=u[0],f=u[1],s=Yt(Object(n.useState)(!1),2),p=s[0],y=s[1],m=Object(n.useMemo)((function(){return new j.m({belong:e,placeholder:__("请添加评论...")})}),[e.id]),d=function(){var t,n=(t=Bt().mark((function t(){return Bt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return y(!0),t.next=3,m.contentReady();case 3:if(!m.isEmpty()){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,r({commentable_type:"Doc",commentable_id:e.id,type:O.a.TYPE.WORDING_COMMENT,body_asl:m.getValue(),body:m.getHtml(),format:g.a.FORMAT.LAKE,parent_id:i,root_id:a,to_user_id:o.id});case 7:m.clearCache();case 8:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Vt(i,n,o,a,c,"next",t)}function c(t){Vt(i,n,o,a,c,"throw",t)}a(void 0)}))});return function(){return n.apply(this,arguments)}}();return{state:{doc:e,isEmpty:l,replyingTo:o,loading:p},onContentChange:function(){f(m.isEmpty())},createReply:d,editorOnload:function(){m.focus(!0)},cancelReply:c,editor:m}}function Wt(t){var e=qt(t),r=e.state,n=Object(_.b)(t.doc);return o.a.createElement("div",{className:At,"data-testid":"select-word-comment"},o.a.createElement("div",{className:Lt},o.a.createElement(Kt,{editor:e.editor,onChange:e.onContentChange,onSubmit:e.createReply,onLoad:e.editorOnload})),o.a.createElement("div",{className:It},o.a.createElement("div",{className:Nt},o.a.createElement(b.a,{type:"primary",disabled:r.isEmpty||r.loading||n,onClick:e.createReply},__("回复"))),o.a.createElement("div",{className:Nt},o.a.createElement(b.a,{className:Gt,onClick:e.cancelReply},__("取消"))),o.a.createElement("div",{className:Dt},o.a.createElement("div",{className:Mt},o.a.createElement("span",null,__("回复")," "),o.a.createElement("span",{className:Ut},"@",r.replyingTo&&r.replyingTo.name)))),n&&o.a.createElement(_.a,null))}Wt.propTypes={doc:y.a.object,selectedInfo:y.a.object,createComment:y.a.func,replyingTo:y.a.object,parent_id:y.a.number,root_id:y.a.number,cancelReply:y.a.func};var Ht=Wt,$t="CommentGroup-module_groupContainer_KczOF",Zt="CommentGroup-module_groupBox_Rwdmw",Jt="CommentGroup-module_header_fIsOp",Qt="CommentGroup-module_title_ptcf0",Xt="CommentGroup-module_actionsBtnGroup_r9Otd",te="CommentGroup-module_actionBtn_eImZP",ee="CommentGroup-module_close_oU6Vu",re="CommentGroup-module_action_wOOTd",ne="CommentGroup-module_disable_Il+lS",oe="CommentGroup-module_active_htoNq",ie="CommentGroup-module_visible_+GH4-";function ae(t){return ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ae(t)}function ce(){ce=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var i=e&&e.prototype instanceof b?e:b,a=Object.create(i.prototype),c=new R(n||[]);return o(a,"_invoke",{value:P(t,r,c)}),a}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var p="suspendedStart",y="suspendedYield",m="executing",d="completed",h={};function b(){}function v(){}function g(){}var w={};l(w,a,(function(){return this}));var O=Object.getPrototypeOf,j=O&&O(O(T([])));j&&j!==r&&n.call(j,a)&&(w=j);var _=g.prototype=b.prototype=Object.create(w);function E(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==ae(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function P(e,r,n){var o=p;return function(i,a){if(o===m)throw new Error("Generator is already running");if(o===d){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=C(c,n);if(u){if(u===h)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var l=s(e,r,n);if("normal"===l.type){if(o=n.done?d:y,l.arg===h)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=d,n.method="throw",n.arg=l.arg)}}}function C(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,C(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=s(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function T(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(ae(e)+" is not iterable")}return v.prototype=g,o(_,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:v,configurable:!0}),v.displayName=l(g,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,l(t,u,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},E(S.prototype),l(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(f(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(_),l(_,u,"Generator"),l(_,a,(function(){return this})),l(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=T,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(u&&l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),k(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:T(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),h}},e}function ue(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function le(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ue(Object(r),!0).forEach((function(e){fe(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ue(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function fe(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==ae(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==ae(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===ae(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function se(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function pe(t){return function(t){if(Array.isArray(t))return de(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||me(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ye(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||me(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function me(t,e){if(t){if("string"==typeof t)return de(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?de(t,e):void 0}}function de(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function he(t){var e=t.doc,r=t.me,o=t.visibility,i=t.comment,a=t.groupArr,c=t.deleteComment,u=t.updateComment,l=t.createReply,f=t.closeSelection,s=t.activeSelectionId,p=t.offsetTop,y=t.focusGroup,m=t.focusPrevGroup,d=t.focusNextGroup,h=ye(Object(n.useState)(null),2),b=h[0],v=h[1],g=e&&e.abilities&&e.abilities.update,w=i.id,O=i.selection_id,j=pe(i.sub_comments).sort((function(t,e){return new Date(t.created_at)-new Date(e.created_at)}))||[],_=[i].concat(pe(j)),E=a.findIndex((function(t){return t.id===w})),S=0===E,P=E===a.length-1,C=function(){v(null)},x=function(){var t,e=(t=ce().mark((function t(e){var r;return ce().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(b){t.next=2;break}return t.abrupt("return");case 2:return r=b.selection,t.next=5,l(le(le({},e),{},{selection:{paragraph_id:r.paragraph_id,range_rect:r.range_rect,text_offset:r.text_offset,text:r.text,selection_range:r.selection_range}}));case 5:C();case 6:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){se(i,n,o,a,c,"next",t)}function c(t){se(i,n,o,a,c,"throw",t)}a(void 0)}))});return function(t){return e.apply(this,arguments)}}();return{state:{doc:e,me:r,visibility:o,canUpdate:g,id:w,selection_id:O,comment:i,comments:_,deleteComment:c,updateComment:u,createReply:l,closeSelection:f,activeSelectionId:s,offsetTop:p,focusGroup:y,focusPrevGroup:m,focusNextGroup:d,replyingComment:b,isFirstGroup:S,isLastGroup:P},reply:function(t){v(t)},cancelReply:C,createComment:x}}var be=o.a.forwardRef((function(t,e){var r=he(t),n=r.state,i=r.reply,a=r.cancelReply,c=r.createComment,u=n.canUpdate,s=n.id,p=n.visibility,y=n.selection_id,m=n.comment,d=n.comments,h=n.deleteComment,b=n.updateComment,v=n.closeSelection,g=n.activeSelectionId,w=n.doc,O=n.me,j=n.offsetTop,_=n.focusGroup,E=n.focusPrevGroup,S=n.focusNextGroup,P=n.replyingComment,C=n.isFirstGroup,x=n.isLastGroup,k=l()($t,y===g?oe:"",p?ie:"");return o.a.createElement("div",{className:k,ref:e,"data-comment-group-id":s,style:{position:"absolute",top:"".concat(j,"px")}},o.a.createElement("div",{className:Zt,onClick:function(){_(s,y)}},o.a.createElement("div",{className:Jt},o.a.createElement("div",{className:Qt},__("{count} 条评论",{count:d.filter((function(t){return null===t.deleted_at})).length})),y===g&&o.a.createElement("div",{className:Xt},o.a.createElement("div",{className:te},C?o.a.createElement("div",{className:l()(re,ne),onClick:function(){E()}},o.a.createElement(f.b,{name:"arrow-up",width:16,height:16})):o.a.createElement(K.a,{title:__("上一条"),placement:"topLeft",arrowPointAtCenter:!0},o.a.createElement("div",{className:l()(re),onClick:function(){E()}},o.a.createElement(f.b,{name:"arrow-up",width:16,height:16})))),o.a.createElement("div",{className:te},x?o.a.createElement("div",{className:l()(re,ne),onClick:function(){S()}},o.a.createElement(f.b,{name:"arrow-down",width:16,height:16})):o.a.createElement(K.a,{title:__("下一条"),placement:"top",arrowPointAtCenter:!0},o.a.createElement("div",{className:l()(re),onClick:function(){S()}},o.a.createElement(f.b,{name:"arrow-down",width:16,height:16})))),u&&o.a.createElement("div",{className:l()(te,ee)},o.a.createElement(K.a,{title:__("标记为隐藏"),placement:"topRight",arrowPointAtCenter:!0},o.a.createElement("div",{className:re,onClick:function(){v(y)}},o.a.createElement(f.b,{name:"comment-hide",width:16,height:16})))))),d.map((function(e,r){return o.a.createElement(Tt,{doc:w,me:O,key:e.id,visibility:p,comment:e,rootComment:m,deleteComment:h,updateComment:b,index:r,reply:i,dispatch:t.dispatch})})),P&&o.a.createElement(Ht,{doc:w,me:O,replyingTo:P.user,createComment:c,parent_id:P.id,root_id:s,cancelReply:a})))}));be.propTypes={doc:y.a.object,me:y.a.object,visibility:y.a.bool,comment:y.a.object,groupArr:y.a.array,deleteComment:y.a.func,updateComment:y.a.func,createReply:y.a.func,closeSelection:y.a.func,activeSelectionId:y.a.number,offsetTop:y.a.number,focusGroup:y.a.func,focusPrevGroup:y.a.func,focusNextGroup:y.a.func,dispatch:y.a.func};var ve=be,ge="SideCommentItem-module_selectionInfo_EkyqK",we="SideCommentItem-module_text_8tA08",Oe="SideCommentItem-module_action_xPcKj";function je(t){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},je(t)}function _e(){_e=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var i=e&&e.prototype instanceof b?e:b,a=Object.create(i.prototype),c=new R(n||[]);return o(a,"_invoke",{value:P(t,r,c)}),a}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var p="suspendedStart",y="suspendedYield",m="executing",d="completed",h={};function b(){}function v(){}function g(){}var w={};l(w,a,(function(){return this}));var O=Object.getPrototypeOf,j=O&&O(O(T([])));j&&j!==r&&n.call(j,a)&&(w=j);var _=g.prototype=b.prototype=Object.create(w);function E(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==je(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function P(e,r,n){var o=p;return function(i,a){if(o===m)throw new Error("Generator is already running");if(o===d){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=C(c,n);if(u){if(u===h)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var l=s(e,r,n);if("normal"===l.type){if(o=n.done?d:y,l.arg===h)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=d,n.method="throw",n.arg=l.arg)}}}function C(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,C(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=s(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function T(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(je(e)+" is not iterable")}return v.prototype=g,o(_,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:v,configurable:!0}),v.displayName=l(g,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,l(t,u,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},E(S.prototype),l(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(f(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(_),l(_,u,"Generator"),l(_,a,(function(){return this})),l(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=T,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(u&&l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),k(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:T(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),h}},e}function Ee(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Se(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Pe(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Se(Object(r),!0).forEach((function(e){Ce(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Se(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Ce(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==je(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==je(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===je(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function xe(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return ke(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ke(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ke(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Re(t){var e,r=t.doc,i=t.me,a=t.comment,c=t.engine,u=t.activeSelectionId,l=t.groupArr,f=t.dispatch,p=t.getDrawRange,y=t.getDefaultPosition,m=t.updateGroupPosition,h=t.deteleGroupPosition,b=t.focusGroup,v=t.focusPrevGroup,g=t.focusNextGroup,w=a.id,O=a.selection_id,j=Object(n.useContext)(D.a),_=Object(n.useRef)(null),E=xe(Object(n.useState)(null),2),S=E[0],P=E[1],C=xe(Object(n.useState)(!window.IntersectionObserver),2),x=C[0],k=C[1],R=z(f),T=R.createComment,A=R.updateComment,L=R.deleteComment,I=F({doc_id:r.id,selection_id:O},f),N=I.openSelection,G=I.closeSelection,M=function(){return N((function(){P(!0),s.a.destroy(),null==j||j.updateComment(Pe(Pe({},a),{},{closed_at:null}))}))},U=function(){var t=p(w);t&&c.viewer.selectWording([t.viewRange],w,O)};Object(n.useEffect)((function(){if(window.ResizeObserver&&_.current){var t=new ResizeObserver(d()((function(){var t=p(w),e=y(t),r=e.x,n=e.y;_.current&&m({id:w,left:r,top:n,height:_.current.getBoundingClientRect().height})}),50));return t.observe(_.current),function(){t.disconnect()}}}),[]),Object(n.useEffect)((function(){if(window.IntersectionObserver&&_.current){var t=new IntersectionObserver(d()((function(t,e){t.forEach((function(t){t.isIntersecting?k(!0):k(!1)}))}),50));return t.observe(_.current),function(){t.disconnect()}}}),[S]);var B,V,Y=(null===(e=l.find((function(t){return t.id===w})))||void 0===e?void 0:e.top)||0;return{state:{doc:r,me:i,activeSelectionId:u,visible:S,visibility:x,groupRef:_,comment:a,groupArr:l,offsetTop:Y},createComment:(B=_e().mark((function t(e){return _e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,T(e);case 2:P(!0),U();case 4:case"end":return t.stop()}}),t)})),V=function(){var t=this,e=arguments;return new Promise((function(r,n){var o=B.apply(t,e);function i(t){Ee(o,r,n,i,a,"next",t)}function a(t){Ee(o,r,n,i,a,"throw",t)}i(void 0)}))},function(t){return V.apply(this,arguments)}),updateComment:function(t){return A(t,(function(){U()}))},deleteComment:function(t){return L(t,(function(){h({id:t}),U(),s.a.success(__("操作成功"),3)}))},closeSelection:function(t){return G(t,(function(){P(!1),s.a.warn(o.a.createElement("div",{className:ge},o.a.createElement("span",{className:we},__("不再显示此处的划词评论，但仍将在下方评论处展示")),o.a.createElement("span",{onClick:M,className:Oe},__("撤销"))),3),null==j||j.updateComment(Pe(Pe({},a),{},{closed_at:(new Date).toISOString()}))}))},focusGroup:b,focusPrevGroup:v,focusNextGroup:g}}var Te=o.a.memo((function(t){var e=Re(t),r=e.state,n=r.comment;return(null!==r.visible?!r.visible:n&&n.selection&&n.selection.closed_at)?null:o.a.createElement(ve,{ref:r.groupRef,doc:r.doc,me:r.me,visibility:r.visibility,comment:n,groupArr:r.groupArr,deleteComment:e.deleteComment,updateComment:e.updateComment,createReply:e.createComment,closeSelection:e.closeSelection,activeSelectionId:r.activeSelectionId,offsetTop:r.offsetTop,focusGroup:e.focusGroup,focusPrevGroup:e.focusPrevGroup,focusNextGroup:e.focusNextGroup,dispatch:t.dispatch})}));Te.propTypes={doc:y.a.object,me:y.a.object,activeSelectionId:y.a.number,dispatch:y.a.func,comment:y.a.object,engine:y.a.object,groupArr:y.a.array,getDrawRange:y.a.func,getDefaultPosition:y.a.func,updateGroupPosition:y.a.func,deteleGroupPosition:y.a.func,focusGroup:y.a.func,focusPrevGroup:y.a.func,focusNextGroup:y.a.func};var Ae=Te;function Le(t){return Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Le(t)}function Ie(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Ne(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ne(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ne(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Ge(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function De(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ge(Object(r),!0).forEach((function(e){Me(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ge(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Me(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==Le(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Le(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===Le(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Ue=function(t,e){var r=e.type,n=e.payload;switch(r){case"select":return De(De({},t),n);case"reset":return{text:"",paragraphId:null,textOffset:null,start:null,end:null,drawRanges:[]}}};function Fe(t){return Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fe(t)}function Be(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Ve(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ve(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ve(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Ye(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function ze(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ye(Object(r),!0).forEach((function(e){Ke(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ye(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Ke(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==Fe(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Fe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===Fe(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var qe=function(t,e){var r=e.type,n=e.payload,o=n.id,i=n.top,a=n.left,c=n.height;switch(r){case"update":return t[o]={top:i,left:a,height:c},ze({},t);case"delete":var u=ze({},t);return delete u[o],u;case"reset":return{}}},We="SideCommentList-module_commentListWrapper_fE+ZY";function He(t){return He="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},He(t)}function $e(){$e=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var i=e&&e.prototype instanceof b?e:b,a=Object.create(i.prototype),c=new R(n||[]);return o(a,"_invoke",{value:P(t,r,c)}),a}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var p="suspendedStart",y="suspendedYield",m="executing",d="completed",h={};function b(){}function v(){}function g(){}var w={};l(w,a,(function(){return this}));var O=Object.getPrototypeOf,j=O&&O(O(T([])));j&&j!==r&&n.call(j,a)&&(w=j);var _=g.prototype=b.prototype=Object.create(w);function E(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==He(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(f).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function P(e,r,n){var o=p;return function(i,a){if(o===m)throw new Error("Generator is already running");if(o===d){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=C(c,n);if(u){if(u===h)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var l=s(e,r,n);if("normal"===l.type){if(o=n.done?d:y,l.arg===h)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=d,n.method="throw",n.arg=l.arg)}}}function C(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,C(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=s(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function T(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(He(e)+" is not iterable")}return v.prototype=g,o(_,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:v,configurable:!0}),v.displayName=l(g,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,l(t,u,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},E(S.prototype),l(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(f(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},E(_),l(_,u,"Generator"),l(_,a,(function(){return this})),l(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=T,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(u&&l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),k(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:T(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),h}},e}function Ze(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Je(t){return function(t){if(Array.isArray(t))return Qe(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return Qe(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Qe(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qe(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Xe(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function tr(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==He(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==He(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===He(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function er(t){var e,r,o,i=t.getEngine,a=t.doc,c=t.me,u=t.wordingComments,l=t.wordingList,f=t.flattenFloorComments,p=t.dispatch,y=t.sideCommentState,m=t.dispatchSideComment,b=z(p).createComment,v={selectedInfo:(e=Ie(Object(n.useReducer)(Ue,{text:"",paragraphId:null,textOffset:null,start:null,end:null,drawRanges:[]}),2))[0],dispatch:e[1]},g=v.selectedInfo,w=v.dispatch,O=function(){var t=Be(Object(n.useReducer)(qe,{}),2);return{groupPosition:t[0],dispatch:t[1]}}(),j=O.groupPosition,_=O.dispatch,E=y.creatorVisible,S=y.activeCommentId,P=y.activeSelectionId,C=Object(n.useRef)(null),x=function(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},k=function(t){var e=Object.entries(t).sort((function(t,e){return t[1].top<e[1].top?-1:t[1].top>e[1].top?1:t[1].left-e[1].left})).map((function(t){return function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Xe(Object(r),!0).forEach((function(e){tr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Xe(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({id:+t[0]},t[1])}));return e},R=function(t,e){for(var r=0,n=0;n<t.length;n++){var o=t[n];if(o.id===e){o.top>r&&(r=o.top);break}r=o.top>=r?o.top+o.height+20:r+o.height+20}return r},T=function(t){return i().viewer.getAllDrawRanges().find((function(e){return e.commentId===t}))},A=function(t){if(!t)return{x:0,y:0};var e=t.rects.filter((function(t){return!(0===t.width&&t.x<0)})).reduce((function(t,e){return t.concat(e.y)}),[]);if(0===e.length){var r=i().viewer.getRootCollapsedDOMNode(t.viewRange.start.node);e=r?[r.getBoundingClientRect().y]:[0]}return{x:t.rects[0].x,y:Math.min.apply(Math,Je(e))}},L=function(t){m({type:"transform",payload:{translateY:t}})},I=function(){m({type:"resetTransform"})},N=function(t){var e=t.paragraphId,r=t.text,n=t.textOffset,o=t.start,i=t.end,a=t.drawRanges;m({type:"showCreator",payload:{selectionId:a[0].selectionId,commentId:a[0].commentId}}),w({type:"select",payload:{paragraphId:e,text:r,textOffset:n,start:o,end:i,drawRanges:a}})},G=function(){m({type:"hideCreator"}),_({type:"delete",payload:{id:0}}),w({type:"reset"})},D=function(){G(),i().viewer.clearHighlightWording()},M=function(t){var e=t.commentId,r=t.selectionId;G(),m({type:"focusComment",payload:{selectionId:r,commentId:e}})},U=function(){S&&P&&m({type:"unfocusComment"})},F=d()((function(t){document.body.scrollHeight>(window.innerHeight||document.documentElement.clientHeight)&&(0===x()&&I())}),50),B=function(t){var e=x()+i().viewer.domRootNode.getBoundingClientRect().top,r=A(t).y+e-120;window.scrollTo({top:r,left:0,behavior:"smooth"})},V=function(t,e){var r;if(S!==t||P!==e||arguments.length>2&&void 0!==arguments[2]&&arguments[2]){var n=f.find((function(e){return e.id===t})),o=null==n||null===(r=n.selection)||void 0===r?void 0:r.paragraph_id,a=i();a&&o&&(a.execCommand("tryUnfold",o),a.execCommand("tryUnfoldCollapse",o),a.viewer.recomputeDrawRanges());var c=T(t);c?a.viewer.selectWordingComment(t,e,(function(){B(c)})):function(t,e,r){var n=t&&document.getElementById(t);if(n){var o=x()+n.getBoundingClientRect().top-120;window.scrollTo({top:o,left:0,behavior:"smooth"}),i().viewer.selectWordingComment(e,r,(function(){var t=T(e);t&&B(t)}))}}(o,t,e)}},Y=Object(n.useMemo)((function(){return function(t){var e=k(t);return e.map((function(t){var r=t.id;return{id:r,top:R(e,r)}}))}(j)}),[j]);return Object(n.useEffect)((function(){var t=i();return t.on("creatingComment",N),t.on("cancelCreatingComment",D),t.on("focusComment",M),t.on("unfocusComment",U),window.addEventListener("scroll",F),function(){t.off("creatingComment",N),t.off("cancelCreatingComment",D),t.off("focusComment",M),t.off("unfocusComment",U),window.removeEventListener("scroll",F)}}),[u,S]),Object(n.useEffect)((function(){if(S){var t=function(t,e){var r=T(e);if(!r)return 0;var n=A(r).y,o=k(t);return n-R(o,e)}(j,S);L(t)}}),[S,j]),Object(n.useEffect)((function(){return C.current=Object(h.b)(),C.current.on(h.a.SCROLL,(function(t){var e=t.comment_id,r=t.id;l.find((function(t){return t.commentId===e}))?V(e,r,!0):s.a.warn(__("内容有更新，选区已丢失"))})),function(){C.current&&C.current.removeAllListeners()}}),[l]),{state:{selectedInfo:g,activeSelectionId:P,creatorVisible:E,translateY:y.translateY,doc:a,me:c,groupPosition:j,wordingComments:u,groupArr:Y},dispatch:p,getEngine:i,getScrollTop:x,getOffsetTop:R,getDrawRange:T,getDefaultGroupArr:k,getDefaultPosition:A,createComment:(r=$e().mark((function t(e){var r;return $e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b(e);case 2:r=t.sent,G(),r&&i().viewer.selectWordingComment(r.id,r.selection.id);case 5:case"end":return t.stop()}}),t)})),o=function(){var t=this,e=arguments;return new Promise((function(n,o){var i=r.apply(t,e);function a(t){Ze(i,n,o,a,c,"next",t)}function c(t){Ze(i,n,o,a,c,"throw",t)}a(void 0)}))},function(t){return o.apply(this,arguments)}),cancelComment:function(){D()},updateGroupPosition:function(t){_({type:"update",payload:t})},deteleGroupPosition:function(t){_({type:"delete",payload:t})},focusGroup:V,focusPrevGroup:function(){var t,e,r=Y.findIndex((function(t){return t.id===S})),n=null===(t=Y[r-1])||void 0===t?void 0:t.id,o=null===(e=u.find((function(t){return t.id===n})))||void 0===e?void 0:e.selection_id;n&&o&&V(n,o)},focusNextGroup:function(){var t,e,r=Y.findIndex((function(t){return t.id===S})),n=null===(t=Y[r+1])||void 0===t?void 0:t.id,o=null===(e=u.find((function(t){return t.id===n})))||void 0===e?void 0:e.selection_id;n&&o&&V(n,o)},transformAllGroup:L,clearAllGroupTransform:I}}var rr=function(t){var e=er(t),r=e.state,n=e.dispatch,i=e.getEngine,a=e.createComment,c=e.cancelComment,u=e.updateGroupPosition,l=e.deteleGroupPosition,f=e.getScrollTop,s=e.getOffsetTop,p=e.getDrawRange,y=e.getDefaultGroupArr,m=e.getDefaultPosition,d=e.focusGroup,h=e.focusPrevGroup,b=e.focusNextGroup,v=e.transformAllGroup,g=e.clearAllGroupTransform,w=i(),O=f()+w.viewer.domRootNode.getBoundingClientRect().top-60;return o.a.createElement("div",{className:We,style:{marginTop:"".concat(O,"px"),transform:"translateY(".concat(r.translateY,"px)")}},r.wordingComments.map((function(t){return o.a.createElement(Ae,{key:t.id,doc:r.doc,me:r.me,comment:t,engine:w,activeSelectionId:r.activeSelectionId,groupArr:r.groupArr,dispatch:n,getDrawRange:p,getDefaultPosition:m,updateGroupPosition:u,deteleGroupPosition:l,focusGroup:d,focusPrevGroup:h,focusNextGroup:b})})),r.creatorVisible&&o.a.createElement(G,{doc:r.doc,selectedInfo:r.selectedInfo,groupPosition:r.groupPosition,createComment:a,cancelComment:c,getDefaultGroupArr:y,getDefaultPosition:m,getOffsetTop:s,updateGroupPosition:u,transformAllGroup:v,clearAllGroupTransform:g}))};rr.propTypes={doc:y.a.object,me:y.a.object,dispatch:y.a.func,getEngine:y.a.func,wordingComments:y.a.array,flattenFloorComments:y.a.array,sideCommentState:y.a.object,dispatchSideComment:y.a.func};var nr=rr;function or(t){return or="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},or(t)}function ir(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return ar(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ar(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ar(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function cr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function ur(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?cr(Object(r),!0).forEach((function(e){lr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):cr(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function lr(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==or(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==or(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===or(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function fr(t,e){var r=e.type,n=e.payload,o=void 0===n?{}:n,i=o.commentId,a=o.selectionId,c=o.translateY;switch(r){case"hideCreator":return ur(ur({},t),{},{commentsVisible:!0,creatorVisible:!1});case"showCreator":return ur(ur({},t),{},{commentsVisible:!0,creatorVisible:!0,activeSelectionId:a,activeCommentId:i});case"focusComment":return ur(ur({},t),{},{creatorVisible:0===a,commentsVisible:!0,activeSelectionId:a,activeCommentId:i});case"unfocusComment":return ur(ur({},{commentsVisible:null,creatorVisible:!1,activeSelectionId:0,activeCommentId:0,translateY:0}),{},{commentsVisible:t.commentsVisible,translateY:t.translateY});case"transform":return ur(ur({},t),{},{translateY:c});case"resetTransform":return ur(ur({},t),{},{translateY:0});case"hideComments":return ur(ur({},{commentsVisible:null,creatorVisible:!1,activeSelectionId:0,activeCommentId:0,translateY:0}),{},{commentsVisible:!1});case"showComments":return ur(ur({},t),{},{commentsVisible:!0})}}var sr=function(){var t=ir(Object(n.useReducer)(fr,{commentsVisible:null,creatorVisible:!1,activeSelectionId:0,activeCommentId:0,translateY:0}),2);return{sideCommentState:t[0],dispatch:t[1]}};function pr(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return yr(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return yr(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function yr(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var mr=function(t){var e=t.doc,r=t.me,o=t.getEngine,i=t.litecomment,a=t.getContainer,c=t.dispatch,u=t.sidePanelManager,l=pr(Object(n.useState)(!1),2),f=l[0],s=l[1],p=pr(Object(n.useState)([]),2),y=p[0],m=p[1],h=pr(Object(n.useState)([]),2),b=h[0],v=h[1],g=pr(Object(n.useState)(0),2),w=g[0],j=g[1],_=pr(Object(n.useState)(!1),2),E=_[0],S=_[1],P=sr(),C=P.sideCommentState,x=P.dispatch,k=e&&"lake"===e.format,R=!!new URL(document.location).searchParams.get("translate"),T=C.commentsVisible,A=Object(n.useMemo)((function(){return i.comments.filter((function(t){var e=t.type,r=t.selection;return e===O.a.TYPE.WORDING_COMMENT&&null===r.closed_at}))}),[i.comments]),L=Object(n.useMemo)((function(){return A.reduce((function(t,e){var r;return t.push(e),null===(r=e.sub_comments)||void 0===r||r.forEach((function(e){t.push(e)})),t}),[])}),[A]);return Object(n.useEffect)((function(){return u.subscribe(d()((function(){o().viewer.wording_rerenderWording()}),1e3))}),[u]),Object(n.useEffect)((function(){s(!0)}),[e.id]),Object(n.useEffect)((function(){var t=o(),e=function(e){e.renderList;var r=t.viewer.getAllDrawRanges().map((function(t){return t.commentId}));m(A.filter((function(t){return r.indexOf(t.id)>=0})))};return t.on("tileRendered",e),function(){t.off("tileRendered",e)}}),[A]),Object(n.useEffect)((function(){var t=o(),e=A.map((function(t){var e=t.id,r=t.selection,n=t.sub_comments,o=void 0===n?[]:n,i=t.deleted_at;return{selection:r,commentId:e,commentsCount:o.filter((function(t){return null===t.deleted_at})).length+(null===i?1:0)}}));if(t&&e){var r=t.viewer.getWordingList(e);j(r.map((function(t){return t.commentsCount})).reduce((function(t,e){return t+e}),0)),v(r),f?(t.viewer.tileRenderWording(r),s(!1)):t.viewer.tileRenderWording(r,{clearCache:!1})}}),[A]),Object(n.useEffect)((function(){var t;T||o().viewer.clearHighlightWording();E||null===T||(t=new CustomEvent("contentSidebarVisibleChange",{detail:{visible:T,type:"wordingComment"}}),window.dispatchEvent(t)),S(!1),u&&T&&u.show("WordingComment")}),[T]),{state:{panelVisible:T,sideCommentState:C,isTranslating:R,isLake:k,doc:e,me:r,wordingComments:y,wordingList:b,wordingSelectionsCount:w,flattenFloorComments:L},dispatch:c,getEngine:o,getContainer:a,dispatchSideComment:x,onClose:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];u&&u.hide("WordingComment"),S(t),x({type:"hideComments"})}}},dr="index-module_commentPanel_rHJ+M",hr="index-module_toolbar_WR5Oc",br="index-module_toolbarContent_wiz0k",vr="index-module_text_Mbvbt",gr="index-module_closeBtn_wG-wO",wr="index-module_closeIcon_BZ+U-",Or="index-module_visible_Rew5O",jr="index-module_hidden_QeAYC",_r=Object(n.forwardRef)((function(t,e){var r=Object(n.useRef)(null),i=mr(t),c=i.state,u=i.getContainer,s=i.getEngine,p=i.dispatch,y=i.dispatchSideComment,m=i.onClose,d=u(),h="",b={};null===c.panelVisible?h="":c.panelVisible?(h=Or,r.current&&(r.current.style.display="")):(h=jr,b.display="none",r.current&&(r.current.style.display="none"));var v=l()(dr,h);function g(t){var e=t.onLayout;return Object(n.useEffect)((function(){return y({type:"showComments"}),e({width:305}),function(){y({type:"hideComments"})}}),[]),o.a.createElement(o.a.Fragment,null)}return Object(n.useImperativeHandle)(e,(function(){return{onClose:m}})),Object(n.useEffect)((function(){t.sidePanelManager&&d&&(window.sidePanelManager=t.sidePanelManager,t.sidePanelManager.registerContent("WordingComment",g))}),[d]),c.isLake&&!c.isTranslating&&d?a.a.createPortal(o.a.createElement("div",{className:v,ref:r,style:b},o.a.createElement("div",{className:hr},o.a.createElement("div",{className:br},o.a.createElement("div",{className:vr},__("划词评论（{count}）",{count:c.wordingSelectionsCount})),o.a.createElement("div",{className:gr,onClick:function(){m(!1)}},o.a.createElement(f.b,{name:"close",className:wr})))),o.a.createElement(nr,{doc:c.doc,me:c.me,getEngine:s,wordingComments:c.wordingComments,wordingList:c.wordingList,flattenFloorComments:c.flattenFloorComments,sideCommentState:c.sideCommentState,dispatch:p,dispatchSideComment:y})),d):null}));e.default=Object(c.d)((function(t){return{me:t.me,doc:t.doc,book:t.book,litecomment:t.litecomment}}),null,null,{forwardRef:!0})(_r)}}]);